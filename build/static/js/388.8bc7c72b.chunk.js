"use strict";(self.webpackChunkloan_management_pwa=self.webpackChunkloan_management_pwa||[]).push([[388],{37388:(e,t,a)=>{a.r(t),a.d(t,{default:()=>se});var r=a(89379),n=a(65043),o=a(88047),s=a(70298),i=a(53969),l=a(24343),c=a(26529),d=a(42579),u=a(47471),p=a(40405),m=a(55895),x=a(94799),h=a(25726),b=a(79693),g=a(99147),A=a(91449),j=a(12097),y=a(80172),f=a(38517),v=a(81911),S=a(78776),w=a(95315),k=a(82394),C=a(79801),D=a(66185),I=a(85877),M=a(33309),L=a(12843),W=a(1947),R=a(60267),N=a(58128),P=a(71101),z=a(9665),Y=a(14854),B=a(27421),F=a(50103),Z=a(69200),E=a(90419),T=a(93201),V=a(28793),q=a(24793),O=a(83542),$=a(59267),_=a(57488),U=a(60446),H=a.n(U),J=a(5766),G=a.n(J),X=a(70579);const K=[{label:"1 Week",value:1},{label:"2 Weeks",value:2},{label:"3 Weeks",value:3},{label:"4 Weeks",value:4}],Q=e=>({"& .MuiOutlinedInput-root":{"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:e.palette.secondary.main},"& .MuiInputBase-input":{padding:"10px 12px",fontSize:"0.875rem"}},"& .MuiInputLabel-root.Mui-focused":{color:e.palette.secondary.main},"& .MuiInputLabel-root":{fontSize:"0.875rem",transform:"translate(12px, 12px) scale(1)"},"& .MuiInputLabel-shrink":{transform:"translate(12px, -9px) scale(0.75)"},"& .MuiFormHelperText-root":{fontSize:"0.75rem"}}),ee=["Borrower Details","Loan Details","Review & Submit"],te=(0,N.Ay)("div")(e=>{let{theme:t,ownerState:a}=e;return(0,r.A)((0,r.A)({backgroundColor:"dark"===t.palette.mode?t.palette.grey[700]:"#ccc",zIndex:1,color:"#fff",width:40,height:40,display:"flex",borderRadius:"50%",justifyContent:"center",alignItems:"center"},a.active&&{backgroundImage:"linear-gradient(136deg, ".concat(t.palette.primary.main," 0%, ").concat(t.palette.secondary.main," 100%)"),boxShadow:"0 4px 10px 0 rgba(0,0,0,.25)"}),a.completed&&{backgroundImage:"linear-gradient(136deg, ".concat(t.palette.primary.dark," 0%, ").concat(t.palette.secondary.dark," 100%)")})});function ae(e){const{active:t,completed:a,className:r,icon:n}=e,o={1:(0,X.jsx)(Z.A,{sx:{fontSize:20}}),2:(0,X.jsx)(E.A,{sx:{fontSize:20}}),3:(0,X.jsx)(T.A,{sx:{fontSize:20}})};return(0,X.jsx)(te,{ownerState:{completed:a,active:t},className:r,children:o[String(n)]})}const re=(0,N.Ay)(o.A)(e=>{let{theme:t}=e;return{["&.".concat(W.A.alternativeLabel)]:{top:22},["&.".concat(W.A.active)]:{["& .".concat(W.A.line)]:{backgroundImage:"linear-gradient(95deg, ".concat(t.palette.primary.main," 0%, ").concat(t.palette.secondary.main," 100%)")}},["&.".concat(W.A.completed)]:{["& .".concat(W.A.line)]:{backgroundImage:"linear-gradient(95deg, ".concat(t.palette.primary.dark," 0%, ").concat(t.palette.secondary.dark," 100%)")}},["& .".concat(W.A.line)]:{height:3,border:0,backgroundColor:"dark"===t.palette.mode?t.palette.grey[800]:"#eaeaf0",borderRadius:1}}});function ne(){const e=(0,R.A)(),{addLoan:t,addActivityLog:a,settings:r}=(0,$.j)(),[o,M]=(0,n.useState)(0),[L,W]=(0,n.useState)(""),[N,Z]=(0,n.useState)(""),[E,T]=(0,n.useState)(""),[V,q]=(0,n.useState)(1),[O,U]=(0,n.useState)(""),[J,te]=(0,n.useState)(!1),[ne,oe]=(0,n.useState)(!1),[se,ie]=(0,n.useState)(!1),[le,ce]=(0,n.useState)(""),[de,ue]=(0,n.useState)(""),[pe,me]=(0,n.useState)(""),[xe,he]=(0,n.useState)([]),[be,ge]=(0,n.useState)(0),[Ae,je]=(0,n.useState)(!1),ye=(0,n.useRef)(null);(0,n.useEffect)(()=>{"contacts"in navigator&&"select"in navigator.contacts?je(!0):console.warn("Contact Picker API not supported in this browser or context.")},[]);const fe=async()=>{if(Ae){te(!0),U("");try{const e=["name","tel"],t={multiple:!1},a=await navigator.contacts.select(e,t);if(a&&a.length>0){const e=a[0];e.name&&e.name.length>0&&W(e.name.join(" ")),e.tel&&e.tel.length>0&&Z(e.tel[0].replace(/\D/g,"")),_.oR.success("Contact details imported!")}else _.oR.info("No contact was selected.")}catch(e){console.error("Error accessing contacts:",e),"NotAllowedError"===e.name||"SecurityError"===e.name?_.oR.error("Permission denied to access contacts. Please grant access in your browser settings."):"AbortError"===e.name?_.oR.info("Contact selection cancelled."):_.oR.error("Failed to access contacts. "+(e.message||""))}finally{te(!1)}}else _.oR.warn("Your browser does not support picking contacts directly.")},ve=(null===r||void 0===r?void 0:r.interestRates)||{1:.15,2:.2,3:.3,4:.3},Se=(e,t)=>e*(ve[t]||0),we=()=>{L.trim()&&/^[a-zA-Z\s]{2,50}$/.test(L.trim())?ce(""):ce("Borrower name must be 2-50 characters, containing only letters and spaces.")},ke=()=>{N.trim()&&/^\d{10}$/.test(N.trim())?ue(""):ue("Phone number must be exactly 10 digits.")},Ce=()=>{const e=Number(E);isNaN(e)||e<=0?me("Loan amount must be a valid positive number."):me("")},De=Number(E),Ie=Se(De,V),Me=De+Ie,Le=Q(e),We=()=>{ie(!1),he([]),ye.current&&(ye.current.value=null)};return(0,X.jsxs)(x.A,{elevation:4,sx:{maxWidth:500,mx:"auto",mt:2,p:2,borderRadius:3,border:e=>"1px solid ".concat(e.palette.divider)},children:[(0,X.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,X.jsx)(m.A,{variant:"h6",fontWeight:"bold",children:"Add New Loan (Auto)"}),(0,X.jsx)(c.A,{title:"Import multiple loans from CSV",children:(0,X.jsx)(d.A,{color:"secondary",onClick:()=>ie(!0),disabled:J||ne,"aria-label":"import loans",size:"small",children:(0,X.jsx)(Y.A,{})})})]}),(0,X.jsx)(h.A,{alternativeLabel:!0,activeStep:o,connector:(0,X.jsx)(re,{}),sx:{mb:3},children:ee.map(e=>(0,X.jsx)(b.A,{children:(0,X.jsx)(g.A,{StepIconComponent:ae,sx:{fontSize:"0.875rem"},children:e})},e))}),O&&(0,X.jsx)(A.A,{severity:"error",onClose:()=>U(""),sx:{mb:1.5,fontSize:"0.875rem"},children:O}),(t=>{switch(t){case 0:return(0,X.jsxs)(s.A,{spacing:1.5,sx:{py:1.5},children:[(0,X.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,X.jsx)(l.A,{label:"Borrower Name",value:L,onChange:e=>W(e.target.value),onBlur:we,fullWidth:!0,required:!0,inputProps:{maxLength:50},error:!!le,helperText:le,sx:Le}),Ae?(0,X.jsx)(c.A,{title:"Import from device contacts",children:(0,X.jsx)(d.A,{color:"secondary",onClick:fe,disabled:J||ne,"aria-label":"import contact",size:"small",children:(0,X.jsx)(z.A,{})})}):(0,X.jsx)(c.A,{title:"Your browser does not support the Contact Picker API.",children:(0,X.jsx)("span",{children:(0,X.jsx)(d.A,{color:"primary",disabled:!0,"aria-label":"import contact not supported",size:"small",children:(0,X.jsx)(z.A,{})})})})]}),(0,X.jsx)(l.A,{label:"Phone Number",value:N,onChange:e=>Z(e.target.value),onBlur:ke,fullWidth:!0,required:!0,inputProps:{maxLength:10,inputMode:"numeric",pattern:"[0-9]*"},error:!!de,helperText:de,sx:Le})]});case 1:return(0,X.jsxs)(s.A,{spacing:1.5,sx:{py:1.5},children:[(0,X.jsx)(l.A,{label:"Loan Amount (ZMW)",value:E,onChange:e=>T(e.target.value),onBlur:Ce,type:"number",inputProps:{min:1},fullWidth:!0,required:!0,error:!!pe,helperText:pe,sx:Le}),(0,X.jsx)(l.A,{select:!0,label:"Interest Duration",value:V,onChange:e=>q(Number(e.target.value)),fullWidth:!0,required:!0,sx:Le,children:K.map(e=>{let{label:t,value:a}=e;return(0,X.jsx)(u.A,{value:a,children:t},a)})}),(0,X.jsx)(p.A,{in:De>0,children:(0,X.jsxs)(i.A,{sx:{p:1.5,bgcolor:"light"===e.palette.mode?e.palette.secondary.light:e.palette.secondary.dark,borderRadius:2,borderLeft:"5px solid ".concat(e.palette.secondary.main)},children:[(0,X.jsxs)(m.A,{variant:"caption",color:"text.secondary",children:["Calculated Interest: ZMW"," ",Ie.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,X.jsxs)(m.A,{variant:"body1",fontWeight:"bold",children:[" ","Total Repayable: ZMW"," ",Me.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]});case 2:return(0,X.jsx)(s.A,{spacing:1.5,sx:{py:1.5},children:(0,X.jsxs)(x.A,{variant:"outlined",sx:{p:1.5,width:"100%"},children:[(0,X.jsx)(m.A,{variant:"subtitle2",gutterBottom:!0,children:"Review Details"}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Borrower:"})," ",L]}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Phone:"})," ",N]}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Principal:"})," ZMW ",De.toLocaleString()]}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Interest Duration:"})," ",V," week",V>1?"s":""]}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Calculated Interest:"})," ZMW ",Ie.toLocaleString()]}),(0,X.jsxs)(m.A,{variant:"body2",fontWeight:"bold",display:"block",children:[(0,X.jsx)("strong",{children:"Total Repayable:"})," ZMW ",Me.toLocaleString()]})]})});default:return"Unknown step"}})(o),(0,X.jsxs)(i.A,{sx:{display:"flex",flexDirection:"row",pt:2},children:[(0,X.jsx)(j.A,{color:"inherit",disabled:0===o||J||ne,onClick:()=>{M(e=>e-1)},sx:{mr:1,px:1,fontSize:"0.875rem"},children:"Back"}),(0,X.jsx)(i.A,{sx:{flex:"1 1 auto"}}),o===ee.length-1?(0,X.jsx)(j.A,{onClick:async()=>{U(""),te(!0);const e=Number(E),r=Se(e,V),n=e+r,o=H()().format("YYYY-MM-DD"),s=H()().add(7*V,"day").format("YYYY-MM-DD");try{const i=await t({borrower:L,phone:N,principal:e,interest:r,totalRepayable:n,startDate:o,dueDate:s,status:"Active",repaidAmount:0,interestDuration:V});await a({action:"Loan Created",details:"Loan created for ".concat(L," (ZMW ").concat(e.toLocaleString(),") [Loan ID: ").concat(i.id,"]"),timestamp:(new Date).toISOString()}),_.oR.success("Loan added successfully! Loan ID: ".concat(i.id)),navigator.vibrate&&navigator.vibrate([100,50,100]),te(!1),W(""),Z(""),T(""),q(1),M(0),ce(""),ue(""),me("")}catch(i){console.error("Loan creation failed:",i),U("Failed to add loan. Please try again."),te(!1)}},variant:"contained",color:"secondary",disabled:J||ne,startIcon:J?(0,X.jsx)(y.A,{size:16,color:"inherit"}):null,sx:{fontSize:"0.875rem"},children:J?"Adding Loan...":"Add Loan"}):(0,X.jsx)(j.A,{onClick:()=>{(e=>{let t=!0;return 0===e?(we(),ke(),!le&&!de&&L.trim()&&N.trim()||(t=!1)):1===e&&(Ce(),!pe&&E.trim()||(t=!1)),t})(o)?M(e=>e+1):_.oR.error("Please correct the errors before proceeding.")},variant:"contained",color:"secondary",disabled:J||ne,sx:{fontSize:"0.875rem"},children:"Next"})]}),(0,X.jsxs)(f.A,{open:se,onClose:We,maxWidth:"sm",fullWidth:!0,children:[(0,X.jsx)(v.A,{sx:{py:1.5,px:2},children:(0,X.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,X.jsx)(m.A,{variant:"h6",children:"Import Loans from CSV"}),(0,X.jsx)(d.A,{onClick:We,"aria-label":"close",size:"small",children:(0,X.jsx)(B.A,{})})]})}),(0,X.jsxs)(S.A,{dividers:!0,sx:{p:2},children:[(0,X.jsx)(m.A,{variant:"body2",color:"text.secondary",sx:{mb:1.5},children:"Upload a CSV file with loan data. Ensure the first row contains these exact headers."}),(0,X.jsx)(x.A,{variant:"outlined",sx:{p:1,mb:1.5,bgcolor:"grey.100"},children:(0,X.jsx)(m.A,{variant:"body2",component:"pre",sx:{overflowX:"auto",whiteSpace:"pre-wrap",wordBreak:"break-all",fontSize:"0.8rem"},children:'"Borrower Name","Phone Number","Loan Amount (ZMW)","Interest Duration (Weeks)"'})}),(0,X.jsx)(j.A,{onClick:()=>{const e="data:text/csv;charset=utf-8,"+encodeURIComponent('"Borrower Name","Phone Number","Loan Amount (ZMW)","Interest Duration (Weeks)"\n"John Doe","1234567890","1000","1"\n"Jane Smith","0987654321","500","2"'),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","loan_import_sample.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t)},color:"primary",variant:"outlined",size:"small",startIcon:(0,X.jsx)(F.A,{}),sx:{mb:1.5,fontSize:"0.75rem"},children:"Download Sample CSV"}),xe.length>0&&(0,X.jsxs)(A.A,{severity:"error",sx:{mb:1.5,fontSize:"0.875rem"},children:[(0,X.jsx)(m.A,{variant:"subtitle2",fontWeight:"bold",children:"Errors found in CSV file:"}),(0,X.jsx)(w.A,{dense:!0,sx:{mt:.5},children:xe.map((e,t)=>(0,X.jsxs)(k.Ay,{disableGutters:!0,sx:{py:0,"& .MuiListItemIcon-root":{minWidth:"24px"}},children:[(0,X.jsx)(C.A,{children:(0,X.jsx)(P.A,{color:"error",sx:{fontSize:"1rem"}})}),(0,X.jsx)(D.A,{primary:e,primaryTypographyProps:{variant:"caption"}})]},t))})]}),(0,X.jsx)("input",{accept:".csv",style:{display:"none"},id:"csv-upload-button-dialog",type:"file",onChange:e=>{const a=e.target.files[0];a&&(oe(!0),he([]),ge(0),G().parse(a,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim(),complete:async e=>{const a=e.data,r=[];let n=0;for(let s=0;s<a.length;s++){const e=a[s],i=s+2;ge(s+1);const l=String(e["Borrower Name"]||"").trim(),c=String(e["Phone Number"]||"").trim(),d=Number(e["Loan Amount (ZMW)"]),u=Number(e["Interest Duration (Weeks)"]);if(!l||!/^[a-zA-Z\s]{2,50}$/.test(l)){r.push("Row ".concat(i,": Invalid 'Borrower Name'. Must be 2-50 letters and spaces."));continue}if(!c||!/^\d{10}$/.test(c)){r.push("Row ".concat(i,": Invalid 'Phone Number'. It must be 10 digits."));continue}if(isNaN(d)||d<=0){r.push("Row ".concat(i,": Invalid 'Loan Amount (ZMW)'. Must be a positive number."));continue}if(isNaN(u)||!K.some(e=>e.value===u)){r.push("Row ".concat(i,": Invalid 'Interest Duration (Weeks)'. Must be 1, 2, 3, or 4."));continue}const p=Se(d,u),m=d+p,x=H()().format("YYYY-MM-DD"),h=H()().add(7*u,"day").format("YYYY-MM-DD");try{await t({borrower:l,phone:c,principal:d,interest:p,totalRepayable:m,startDate:x,dueDate:h,status:"Active",repaidAmount:0,interestDuration:u}),n++}catch(o){console.error("Error adding loan from row ".concat(i,":"),o),r.push("Row ".concat(i,": Failed to add loan to database. (").concat(o.message||"Unknown error",")"))}}oe(!1),ge(0),n>0&&_.oR.success("Successfully imported ".concat(n," loan(s)!")),r.length>0?(he(r),U("CSV Import finished with ".concat(r.length," error(s). Please review the details below.")),r.forEach(e=>_.oR.error("Import Error: ".concat(e),{autoClose:!1}))):ie(!1)},error:e=>{oe(!1),ie(!1),ge(0),U("Failed to parse CSV file: "+e.message),_.oR.error("CSV parsing error: "+e.message),console.error("PapaParse error:",e)}}))},ref:ye}),(0,X.jsx)("label",{htmlFor:"csv-upload-button-dialog",children:(0,X.jsx)(j.A,{variant:"contained",component:"span",color:"secondary",startIcon:ne?(0,X.jsx)(y.A,{size:16,color:"inherit"}):(0,X.jsx)(Y.A,{}),disabled:ne,fullWidth:!0,children:ne?"Importing... (".concat(be," processed)"):"Select CSV File"})})]}),(0,X.jsx)(I.A,{sx:{p:1},children:(0,X.jsx)(j.A,{onClick:We,disabled:ne,sx:{fontSize:"0.875rem"},children:"Cancel"})})]})]})}function oe(){const e=(0,R.A)(),{addLoan:t,addActivityLog:a}=(0,$.j)(),[r,o]=(0,n.useState)(0),[u,f]=(0,n.useState)(""),[v,S]=(0,n.useState)(""),[w,k]=(0,n.useState)(""),[C,D]=(0,n.useState)(H()()),[I,M]=(0,n.useState)(H()().add(1,"week")),[L,W]=(0,n.useState)(""),[N,P]=(0,n.useState)(""),[Y,B]=(0,n.useState)(!1),[F,Z]=(0,n.useState)(""),[E,T]=(0,n.useState)(""),[V,q]=(0,n.useState)(""),[U,J]=(0,n.useState)(""),[G,K]=(0,n.useState)(""),[te,ne]=(0,n.useState)(""),[oe,se]=(0,n.useState)(!1);(0,n.useEffect)(()=>{"contacts"in navigator&&"select"in navigator.contacts?se(!0):console.warn("Contact Picker API not supported in this browser or context.")},[]);const ie=async()=>{if(oe){B(!0),P("");try{const e=["name","tel"],t={multiple:!1},a=await navigator.contacts.select(e,t);if(a&&a.length>0){const e=a[0];e.name&&e.name.length>0&&f(e.name.join(" ")),e.tel&&e.tel.length>0&&S(e.tel[0].replace(/\D/g,"")),_.oR.success("Contact details imported!")}else _.oR.info("No contact was selected.")}catch(e){console.error("Error accessing contacts:",e),"NotAllowedError"===e.name||"SecurityError"===e.name?_.oR.error("Permission denied to access contacts. Please grant access in your browser settings."):"AbortError"===e.name?_.oR.info("Contact selection cancelled."):_.oR.error("Failed to access contacts. "+(e.message||""))}finally{B(!1)}}else _.oR.warn("Your browser does not support picking contacts directly.")},le=(e,t)=>e*(t/100),ce=()=>{u.trim()&&/^[a-zA-Z\s]{2,50}$/.test(u.trim())?Z(""):Z("Borrower name must be 2-50 characters, containing only letters and spaces.")},de=()=>{v.trim()&&/^\d{10}$/.test(v.trim())?T(""):T("Phone number must be exactly 10 digits.")},ue=()=>{const e=Number(w);isNaN(e)||e<=0?q("Loan amount must be a valid positive number."):q("")},pe=()=>{const e=Number(L);isNaN(e)||e<0||e>100?ne("Interest rate must be a number between 0 and 100."):ne("")},me=Number(w),xe=le(me,Number(L)),he=me+xe,be=Q(e);return(0,X.jsxs)(x.A,{elevation:4,sx:{maxWidth:500,mx:"auto",mt:2,p:2,borderRadius:3,border:e=>"1px solid ".concat(e.palette.divider)},children:[(0,X.jsx)(m.A,{variant:"h6",fontWeight:"bold",sx:{mb:2},children:"Add New Loan (Manual)"}),(0,X.jsx)(h.A,{alternativeLabel:!0,activeStep:r,connector:(0,X.jsx)(re,{}),sx:{mb:3},children:ee.map(e=>(0,X.jsx)(b.A,{children:(0,X.jsx)(g.A,{StepIconComponent:ae,sx:{fontSize:"0.875rem"},children:e})},e))}),N&&(0,X.jsx)(A.A,{severity:"error",onClose:()=>P(""),sx:{mb:1.5,fontSize:"0.875rem"},children:N}),(t=>{switch(t){case 0:return(0,X.jsxs)(s.A,{spacing:1.5,sx:{py:1.5},children:[(0,X.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,X.jsx)(l.A,{label:"Borrower Name",value:u,onChange:e=>f(e.target.value),onBlur:ce,fullWidth:!0,required:!0,inputProps:{maxLength:50},error:!!F,helperText:F,sx:be}),oe?(0,X.jsx)(c.A,{title:"Import from device contacts",children:(0,X.jsx)(d.A,{color:"secondary",onClick:ie,disabled:Y,"aria-label":"import contact",size:"small",children:(0,X.jsx)(z.A,{})})}):(0,X.jsx)(c.A,{title:"Your browser does not support the Contact Picker API.",children:(0,X.jsx)("span",{children:(0,X.jsx)(d.A,{color:"primary",disabled:!0,"aria-label":"import contact not supported",size:"small",children:(0,X.jsx)(z.A,{})})})})]}),(0,X.jsx)(l.A,{label:"Phone Number",value:v,onChange:e=>S(e.target.value),onBlur:de,fullWidth:!0,required:!0,inputProps:{maxLength:10,inputMode:"numeric",pattern:"[0-9]*"},error:!!E,helperText:E,sx:be})]});case 1:return(0,X.jsxs)(s.A,{spacing:1.5,sx:{py:1.5},children:[(0,X.jsx)(l.A,{label:"Loan Amount (ZMW)",value:w,onChange:e=>k(e.target.value),onBlur:ue,type:"number",inputProps:{min:1},fullWidth:!0,required:!0,error:!!V,helperText:V,sx:be}),(0,X.jsx)(O.l,{label:"Start Date",value:C,onChange:e=>D(e),enableAccessibleFieldDOMStructure:!1,slots:{textField:l.A},slotProps:{textField:{fullWidth:!0,required:!0,error:!!U,helperText:U,sx:be}}}),(0,X.jsx)(O.l,{label:"Due Date",value:I,onChange:e=>M(e),enableAccessibleFieldDOMStructure:!1,slots:{textField:l.A},slotProps:{textField:{fullWidth:!0,required:!0,error:!!G,helperText:G,sx:be}},minDate:C||H()(),disablePast:!0}),(0,X.jsx)(l.A,{label:"Interest Rate (%)",value:L,onChange:e=>W(e.target.value),onBlur:pe,type:"number",inputProps:{min:0,max:100,step:"0.01"},fullWidth:!0,required:!0,error:!!te,helperText:te,sx:be}),(0,X.jsx)(p.A,{in:me>0&&""!==L,children:(0,X.jsxs)(i.A,{sx:{p:1.5,bgcolor:"light"===e.palette.mode?e.palette.secondary.light:e.palette.secondary.dark,borderRadius:2,borderLeft:"5px solid ".concat(e.palette.secondary.main)},children:[(0,X.jsxs)(m.A,{variant:"caption",color:"text.secondary",children:["Calculated Interest: ZMW"," ",xe.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,X.jsxs)(m.A,{variant:"body1",fontWeight:"bold",children:["Total Repayable: ZMW"," ",he.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]});case 2:return(0,X.jsx)(s.A,{spacing:1.5,sx:{py:1.5},children:(0,X.jsxs)(x.A,{variant:"outlined",sx:{p:1.5,width:"100%"},children:[(0,X.jsx)(m.A,{variant:"subtitle2",gutterBottom:!0,children:"Review Details"}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Borrower:"})," ",u]}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Phone:"})," ",v]}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Principal:"})," ZMW ",me.toLocaleString()]}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Start Date:"})," ",C.format("YYYY-MM-DD")]}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Due Date:"})," ",I.format("YYYY-MM-DD")]}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Interest Rate:"})," ",L,"%"]}),(0,X.jsxs)(m.A,{variant:"caption",display:"block",children:[(0,X.jsx)("strong",{children:"Calculated Interest:"})," ZMW ",xe.toLocaleString()]}),(0,X.jsxs)(m.A,{variant:"body2",fontWeight:"bold",display:"block",children:[(0,X.jsx)("strong",{children:"Total Repayable:"})," ZMW ",he.toLocaleString()]})]})});default:return"Unknown step"}})(r),(0,X.jsxs)(i.A,{sx:{display:"flex",flexDirection:"row",pt:2},children:[(0,X.jsx)(j.A,{color:"inherit",disabled:0===r||Y,onClick:()=>{o(e=>e-1)},sx:{mr:1,px:1,fontSize:"0.875rem"},children:"Back"}),(0,X.jsx)(i.A,{sx:{flex:"1 1 auto"}}),r===ee.length-1?(0,X.jsx)(j.A,{onClick:async()=>{P(""),B(!0);const e=Number(w),r=Number(L),n=le(e,r),s=e+n,i=C.format("YYYY-MM-DD"),l=I.format("YYYY-MM-DD");try{const c=await t({borrower:u,phone:v,principal:e,interest:n,totalRepayable:s,startDate:i,dueDate:l,status:"Active",repaidAmount:0,manualInterestRate:r});await a({action:"Loan Created (Manual)",details:"Manual loan created for ".concat(u," (ZMW ").concat(e.toLocaleString(),") [Loan ID: ").concat(c.id,"]"),timestamp:(new Date).toISOString()}),_.oR.success("Manual loan added successfully! Loan ID: ".concat(c.id)),navigator.vibrate&&navigator.vibrate([100,50,100]),B(!1),f(""),S(""),k(""),D(H()()),M(H()().add(1,"week")),W(""),o(0),Z(""),T(""),q(""),J(""),K(""),ne("")}catch(c){console.error("Manual loan creation failed:",c),P("Failed to add manual loan. Please try again."),B(!1)}},variant:"contained",color:"secondary",disabled:Y,startIcon:Y?(0,X.jsx)(y.A,{size:16,color:"inherit"}):null,sx:{fontSize:"0.875rem"},children:Y?"Adding Loan...":"Add Loan"}):(0,X.jsx)(j.A,{onClick:()=>{(e=>{let t=!0;return 0===e?(ce(),de(),!F&&!E&&u.trim()&&v.trim()||(t=!1)):1===e&&(ue(),pe(),C&&C.isValid()||(J("Invalid start date."),t=!1),I&&I.isValid()?C&&I&&I.isBefore(C,"day")&&(K("Due date cannot be before the start date."),t=!1):(K("Invalid due date."),t=!1),!V&&!te&&w.trim()&&L.trim()||(t=!1)),t})(r)?o(e=>e+1):_.oR.error("Please correct the errors before proceeding.")},variant:"contained",color:"secondary",disabled:Y,sx:{fontSize:"0.875rem"},children:"Next"})]})]})}function se(){const[e,t]=(0,n.useState)(0);return(0,X.jsx)(q.$J,{dateAdapter:V.R,children:(0,X.jsxs)(i.A,{sx:{width:"100%",mt:2},children:[(0,X.jsxs)(M.A,{value:e,onChange:(e,a)=>{t(a)},"aria-label":"loan type tabs",centered:!0,sx:{"& .MuiTabs-indicator":{backgroundColor:e=>e.palette.secondary.main},"& .MuiTab-root":{color:e=>e.palette.text.secondary,"&.Mui-selected":{color:e=>e.palette.secondary.main},fontSize:"0.875rem",minHeight:"48px",padding:"12px 16px"}},children:[(0,X.jsx)(L.A,{label:"Auto Loan"}),(0,X.jsx)(L.A,{label:"Manual Loan"})]}),(0,X.jsxs)(i.A,{sx:{p:2},children:[0===e&&(0,X.jsx)(ne,{}),1===e&&(0,X.jsx)(oe,{})]})]})})}}}]);
//# sourceMappingURL=388.8bc7c72b.chunk.js.map