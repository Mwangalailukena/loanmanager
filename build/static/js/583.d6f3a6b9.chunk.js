"use strict";(self.webpackChunkloan_management_pwa=self.webpackChunkloan_management_pwa||[]).push([[583],{95583:(e,o,a)=>{a.r(o),a.d(o,{default:()=>R});var r=a(89379),t=a(65043),n=a(94799),i=a(55895),l=a(91449),s=a(70298),c=a(2419),d=a(24343),x=a(80172),p=a(53969),m=a(83759),u=a(91244),b=a(16128),h=a(94527),A=a(12097),y=a(38517),f=a(81911),j=a(78776),g=a(9200),w=a(85877),v=a(60267),S=a(45297),M=a(29829),P=a(80687),W=a(90160),C=a(23241),F=a(36642),L=a(59267),I=a(57488),Z=a(70579);function R(){const e=(0,v.A)(),{loans:o,addPayment:a,loadingLoans:R}=(0,L.j)(),[k,O]=(0,t.useState)(null),[z,N]=(0,t.useState)(""),[T,G]=(0,t.useState)(""),[_,q]=(0,t.useState)({}),[B,D]=(0,t.useState)(!1),[E,V]=(0,t.useState)(!1),J=(e,o)=>{q(a=>(0,r.A)((0,r.A)({},a),{},{[e]:o}))};(0,t.useEffect)(()=>{J("loan",""),G("")},[k]),(0,t.useEffect)(()=>{J("amount",""),G("")},[z]);const U=()=>V(!1),Y=k&&k.repaidAmount||0,H=k?k.totalRepayable-Y:0,K=H-Number(z||0),Q={"& .MuiOutlinedInput-root":{"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:e.palette.secondary.main}},"& .MuiInputLabel-root.Mui-focused":{color:e.palette.secondary.main}};return(0,Z.jsxs)(n.A,{elevation:2,sx:{maxWidth:500,mx:"auto",mt:3,p:3,border:e=>"2px solid ".concat(e.palette.primary.main),borderRadius:2},children:[(0,Z.jsx)(i.A,{variant:"h5",sx:{mb:3},children:"Add Payment"}),T&&(0,Z.jsx)(l.A,{severity:"error",onClose:()=>G(""),sx:{mb:2},children:T}),(0,Z.jsx)("form",{onSubmit:e=>{e.preventDefault(),(()=>{let e=!0;const o={};k||(o.loan="Please select a borrower/loan.",e=!1);const a=Number(z);if(isNaN(a)||a<=0)o.amount="Payment amount must be a valid positive number.",e=!1;else if(k){const r=k.totalRepayable-(k.repaidAmount||0);a>r+1e-4&&(o.amount="Payment (ZMW ".concat(a.toFixed(2),") exceeds remaining balance (ZMW ").concat(r.toFixed(2),")."),e=!1)}return q(o),e})()&&V(!0)},children:(0,Z.jsxs)(s.A,{spacing:2,children:[(0,Z.jsx)(c.A,{sx:Q,id:"loan-borrower-search",options:o.filter(e=>"Active"===e.status),getOptionLabel:e=>e.borrower,value:k,onChange:(e,o)=>O(o),loading:R,renderInput:e=>(0,Z.jsx)(d.A,(0,r.A)((0,r.A)({},e),{},{label:"Search Borrower (Name or Phone)",placeholder:"e.g., John Doe or 097xxxxxxx",required:!0,error:!!_.loan,helperText:_.loan||(R?"Loading loans...":""),InputProps:(0,r.A)((0,r.A)({},e.InputProps),{},{endAdornment:(0,Z.jsxs)(Z.Fragment,{children:[R?(0,Z.jsx)(x.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})})),isOptionEqualToValue:(e,o)=>e.id===o.id,renderOption:(e,o)=>{const a=(o.totalRepayable-(o.repaidAmount||0)).toFixed(2).toLocaleString();return(0,Z.jsxs)(p.A,(0,r.A)((0,r.A)({component:"li"},e),{},{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,Z.jsx)(i.A,{variant:"body1",fontWeight:"bold",sx:{flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:o.borrower}),(0,Z.jsx)(m.A,{label:"ZMW ".concat(a),color:"primary",size:"small"})]}))},filterOptions:(e,o)=>{let{inputValue:a}=o;const r=a.toLowerCase();return e.filter(e=>e.borrower.toLowerCase().includes(r)||e.phone.includes(r))},noOptionsText:"No active loans found for this search."}),k&&(0,Z.jsx)(u.A,{variant:"outlined",sx:{bgcolor:H<=.01?e.palette.success.light:e.palette.action.hover,borderColor:H<=.01?e.palette.success.main:e.palette.divider,p:2},children:(0,Z.jsxs)(b.A,{sx:{p:0,"&:last-child":{pb:0}},children:[(0,Z.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mb:1,fontWeight:"bold"},children:"Selected Loan Details"}),(0,Z.jsxs)(s.A,{spacing:1,children:[(0,Z.jsxs)(p.A,{display:"flex",alignItems:"center",gap:1,children:[(0,Z.jsx)(W.A,{color:"primary",fontSize:"small"}),(0,Z.jsxs)(i.A,{variant:"body2",sx:{flexGrow:1},children:["Borrower: ",k.borrower]})]}),(0,Z.jsxs)(p.A,{display:"flex",alignItems:"center",gap:1,children:[(0,Z.jsx)(C.A,{color:"primary",fontSize:"small"}),(0,Z.jsxs)(i.A,{variant:"body2",sx:{flexGrow:1},children:["Phone: ",k.phone]})]}),(0,Z.jsxs)(p.A,{display:"flex",alignItems:"center",gap:1,children:[(0,Z.jsx)(S.A,{color:"primary",fontSize:"small"}),(0,Z.jsxs)(i.A,{variant:"body2",sx:{flexGrow:1},children:["Principal: ZMW ",k.principal.toFixed(2).toLocaleString()]})]}),(0,Z.jsxs)(p.A,{display:"flex",alignItems:"center",gap:1,children:[(0,Z.jsx)(M.A,{color:"primary",fontSize:"small"}),(0,Z.jsxs)(i.A,{variant:"body2",sx:{flexGrow:1},children:["Total Repayable: ZMW ",k.totalRepayable.toFixed(2).toLocaleString()]})]}),(0,Z.jsxs)(p.A,{display:"flex",alignItems:"center",gap:1,children:[(0,Z.jsx)(P.A,{color:"primary",fontSize:"small"}),(0,Z.jsxs)(i.A,{variant:"body2",sx:{flexGrow:1},children:["Already Repaid: ZMW ",Y.toFixed(2).toLocaleString()]})]})]}),(0,Z.jsx)(h.A,{sx:{my:1}}),(0,Z.jsxs)(p.A,{display:"flex",alignItems:"center",gap:1,sx:{mt:1},children:[H<=.01?(0,Z.jsx)(P.A,{color:"success"}):(0,Z.jsx)(F.A,{color:"error"}),(0,Z.jsxs)(i.A,{variant:"h6",fontWeight:"bold",sx:{color:H<=.01?"success.main":"text.primary"},children:["Remaining Balance: ZMW ",H.toFixed(2).toLocaleString()]})]})]})}),(0,Z.jsx)(d.A,{sx:Q,label:"Payment Amount (ZMW)",value:z,onChange:e=>N(e.target.value),type:"number",inputProps:{min:.01,step:"0.01"},fullWidth:!0,required:!0,error:!!_.amount,helperText:_.amount,disabled:!k||B}),k&&parseFloat(z)>0&&(0,Z.jsxs)(p.A,{sx:{p:2,bgcolor:K<=.01?e.palette.success.light:"background.paper",borderRadius:1,border:"1px dashed",borderColor:K<=.01?e.palette.success.main:"grey.300"},children:[(0,Z.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:["After this payment, ",k.borrower,"'s loan balance will be:"]}),(0,Z.jsxs)(i.A,{variant:"h6",fontWeight:"bold",color:K<=.01?"success.main":"text.primary",children:["ZMW ",Math.max(0,K).toFixed(2).toLocaleString(),K<=.01&&" (Loan will be paid in full)"]})]}),(0,Z.jsx)(A.A,{type:"submit",variant:"contained",color:"secondary",disabled:B||!k||!z||parseFloat(z)<=0,startIcon:B?(0,Z.jsx)(x.A,{size:20,color:"inherit"}):null,children:B?"Submitting...":"Add Payment"})]})}),(0,Z.jsxs)(y.A,{open:E,onClose:U,"aria-labelledby":"confirm-payment-title","aria-describedby":"confirm-payment-description",children:[(0,Z.jsx)(f.A,{id:"confirm-payment-title",children:"Confirm Payment"}),(0,Z.jsx)(j.A,{children:k&&(0,Z.jsxs)(g.A,{id:"confirm-payment-description",children:["You are about to add a payment of ZMW ",Number(z).toFixed(2).toLocaleString(),"for ",k.borrower,"'s loan.",(0,Z.jsx)("br",{}),"The current remaining balance is ZMW ",H.toFixed(2).toLocaleString(),".",(0,Z.jsx)("br",{}),"After this payment, the remaining balance will be ZMW ",Math.max(0,K).toFixed(2).toLocaleString(),".",K<=.01&&" (This loan will be marked as Paid.)",(0,Z.jsx)("br",{}),(0,Z.jsx)("br",{}),"Confirm to proceed?"]})}),(0,Z.jsxs)(w.A,{children:[(0,Z.jsx)(A.A,{onClick:U,disabled:B,children:"Cancel"}),(0,Z.jsx)(A.A,{onClick:async()=>{V(!1),D(!0);try{const e=Number(z);await a(k.id,e),I.oR.success("Payment of ZMW ".concat(e.toFixed(2).toLocaleString()," added for ").concat(k.borrower,"!")),O(null),N(""),q({}),G("")}catch(e){console.error("Payment submission failed:",e),G("Failed to add payment. Please try again."),I.oR.error("Failed to add payment: ".concat(e.message||"Unknown error"))}finally{D(!1)}},autoFocus:!0,variant:"contained",color:"secondary",disabled:B,children:"Confirm"})]})]})]})}}}]);
//# sourceMappingURL=583.d6f3a6b9.chunk.js.map