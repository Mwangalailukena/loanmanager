(self.webpackChunkloan_management_pwa=self.webpackChunkloan_management_pwa||[]).push([[16],{20:(e,t,r)=>{"use strict";function a(e,t){if(!t||!t.length)return;const r=Object.keys(t[0]),a=r.join(",")+"\n"+t.map(e=>r.map(t=>{let r=null===e[t]||void 0===e[t]?"":e[t];return r=r.toString().replace(/"/g,'""'),r.search(/("|,|\n)/g)>=0&&(r='"'.concat(r,'"')),r}).join(",")).join("\n"),n=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(n,e);else{const t=document.createElement("a");if(void 0!==t.download){const r=URL.createObjectURL(n);t.setAttribute("href",r),t.setAttribute("download",e),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}}r.d(t,{y:()=>a})},51525:function(e){e.exports=function(){"use strict";return function(e,t,r){t.prototype.isBetween=function(e,t,a,n){var o=r(e),i=r(t),l="("===(n=n||"()")[0],s=")"===n[1];return(l?this.isAfter(o,a):!this.isBefore(o,a))&&(s?this.isBefore(i,a):!this.isAfter(i,a))||(l?this.isBefore(o,a):!this.isAfter(o,a))&&(s?this.isAfter(i,a):!this.isBefore(i,a))}}}()},80016:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>te});var a=r(89379),n=r(65043),o=r(60267),i=r(86995),l=r(53969),s=r(80172),d=r(55895),c=r(94799),u=r(70298),h=r(94527),m=r(12097),p=r(80045),A=r(58387),x=r(31807),g=r(58128),b=r(28301),j=r(79857),f=r(86061);function v(e){return(0,f.Ay)("MuiTableContainer",e)}(0,j.A)("MuiTableContainer",["root"]);var y=r(70579);const D=["className","component"],M=(0,g.Ay)("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),L=n.forwardRef(function(e,t){const r=(0,b.b)({props:e,name:"MuiTableContainer"}),{className:n,component:o="div"}=r,i=(0,p.A)(r,D),l=(0,a.A)((0,a.A)({},r),{},{component:o}),s=(e=>{const{classes:t}=e;return(0,x.A)({root:["root"]},v,t)})(l);return(0,y.jsx)(M,(0,a.A)({ref:t,as:o,className:(0,A.A)(s.root,n),ownerState:l},i))});var P=r(87443),O=r(10756),R=r(86172),S=r(81341),k=r(34375),w=r(10256),C=r(79067),N=r(67203),F=r(47471),W=r(24343),Y=r(68700),T=r(51612),B=r(97194);function I(e){return(0,f.Ay)("MuiFormControlLabel",e)}const Z=(0,j.A)("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]);var _=r(17566),V=r(69905);const E=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slots","slotProps","value"],z=(0,g.Ay)("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[{["& .".concat(Z.label)]:t.label},t.root,t["labelPlacement".concat((0,B.A)(r.labelPlacement))]]}})((0,T.A)(e=>{let{theme:t}=e;return{display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,["&.".concat(Z.disabled)]:{cursor:"default"},["& .".concat(Z.label)]:{["&.".concat(Z.disabled)]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:e=>{let{labelPlacement:t}=e;return"start"===t||"top"===t||"bottom"===t},style:{marginLeft:16}}]}})),q=(0,g.Ay)("span",{name:"MuiFormControlLabel",slot:"Asterisk"})((0,T.A)(e=>{let{theme:t}=e;return{["&.".concat(Z.error)]:{color:(t.vars||t).palette.error.main}}})),H=n.forwardRef(function(e,t){var r;const o=(0,b.b)({props:e,name:"MuiFormControlLabel"}),{checked:i,className:l,componentsProps:s={},control:c,disabled:u,disableTypography:h,inputRef:m,label:g,labelPlacement:j="end",name:f,onChange:v,required:D,slots:M={},slotProps:L={},value:P}=o,O=(0,p.A)(o,E),R=(0,Y.A)(),S=null!==(r=null!==u&&void 0!==u?u:c.props.disabled)&&void 0!==r?r:null===R||void 0===R?void 0:R.disabled,k=null!==D&&void 0!==D?D:c.props.required,w={disabled:S,required:k};["checked","name","onChange","value","inputRef"].forEach(e=>{"undefined"===typeof c.props[e]&&"undefined"!==typeof o[e]&&(w[e]=o[e])});const C=(0,_.A)({props:o,muiFormControl:R,states:["error"]}),N=(0,a.A)((0,a.A)({},o),{},{disabled:S,labelPlacement:j,required:k,error:C.error}),F=(e=>{const{classes:t,disabled:r,labelPlacement:a,error:n,required:o}=e,i={root:["root",r&&"disabled","labelPlacement".concat((0,B.A)(a)),n&&"error",o&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",n&&"error"]};return(0,x.A)(i,I,t)})(N),W={slots:M,slotProps:(0,a.A)((0,a.A)({},s),L)},[T,Z]=(0,V.A)("typography",{elementType:d.A,externalForwardedProps:W,ownerState:N});let H=g;return null==H||H.type===d.A||h||(H=(0,y.jsx)(T,(0,a.A)((0,a.A)({component:"span"},Z),{},{className:(0,A.A)(F.label,null===Z||void 0===Z?void 0:Z.className),children:H}))),(0,y.jsxs)(z,(0,a.A)((0,a.A)({className:(0,A.A)(F.root,l),ownerState:N,ref:t},O),{},{children:[n.cloneElement(c,w),k?(0,y.jsxs)("div",{children:[H,(0,y.jsxs)(q,{ownerState:N,"aria-hidden":!0,className:F.asterisk,children:["\u2009","*"]})]}):H]}))});var U=r(26711),X=r(59267),G=r(20),J=r(60446),K=r.n(J),Q=r(51525),$=r.n(Q);K().extend($());const ee=e=>{const t=K()(),r=K()(e.dueDate);return e.isPaid||e.repaidAmount>=e.totalRepayable&&e.totalRepayable>0&&!e.status||"Paid"===e.status?"Paid":r.isBefore(t,"day")?"Overdue":"Active"};function te(){const{loans:e,loadingLoans:t,payments:r,loadingPayments:p,getAllPayments:A}=(0,X.j)(),x=(0,o.A)(),g=(0,i.A)(x.breakpoints.down("sm")),[b,j]=(0,n.useState)("portfolioSummary"),[f,v]=(0,n.useState)(K()().subtract(6,"months").startOf("month").format("YYYY-MM-DD")),[D,M]=(0,n.useState)(K()().endOf("month").format("YYYY-MM-DD")),[Y,T]=(0,n.useState)(!0),[B,I]=(0,n.useState)(!0),[Z,_]=(0,n.useState)(!0);(0,n.useEffect)(()=>{r||p||A()},[r,p,A]);const V=(0,n.useMemo)(()=>{if(t||!e)return[];const r=K()(f),a=K()(D);return e.filter(e=>{const t=K()(e.startDate),n=ee(e),o=t.isBetween(r,a,"day","[]");let i=!1;return"Paid"===n&&Y&&(i=!0),"Active"===n&&B&&(i=!0),"Overdue"===n&&Z&&(i=!0),o&&i})},[e,f,D,Y,B,Z,t]),E=(0,n.useMemo)(()=>{if(t||!e)return{totalLoans:0,activeLoans:0,paidLoans:0,overdueLoans:0,totalPrincipalDisbursed:0,totalInterestAccrued:0,totalOutstanding:0,totalRepaid:0};let r=0,a=0,n=0,o=0,i=0,l=0,s=0;return V.forEach(e=>{const t=ee(e);"Active"===t?r++:"Paid"===t?a++:"Overdue"===t&&n++,o+=Number(e.principal||0),i+=Number(e.interest||0),s+=Number(e.repaidAmount||0),l+=Number(e.totalRepayable||0)-Number(e.repaidAmount||0)}),{totalLoans:V.length,activeLoans:r,paidLoans:a,overdueLoans:n,totalPrincipalDisbursed:o,totalInterestAccrued:i,totalOutstanding:l,totalRepaid:s}},[V,e,t]),z=(0,n.useMemo)(()=>{if(t||!e)return{buckets:{},list:[]};const r=K()(),a={"1-7 Days Overdue":[],"8-14 Days Overdue":[],"15-30 Days Overdue":[],"30+ Days Overdue":[]},n=[];return V.forEach(e=>{if("Overdue"===ee(e)){const t=K()(e.dueDate),o=r.diff(t,"day"),i=Number(e.totalRepayable||0)-Number(e.repaidAmount||0);if(i<=0)return;const l={id:e.id,borrower:e.borrower,phone:e.phone,principal:Number(e.principal||0),interest:Number(e.interest||0),totalRepayable:Number(e.totalRepayable||0),repaidAmount:Number(e.repaidAmount||0),outstanding:i,startDate:e.startDate,dueDate:e.dueDate,daysOverdue:o};o>=1&&o<=7?a["1-7 Days Overdue"].push(l):o>=8&&o<=14?a["8-14 Days Overdue"].push(l):o>=15&&o<=30?a["15-30 Days Overdue"].push(l):o>30&&a["30+ Days Overdue"].push(l),n.push(l)}}),n.sort((e,t)=>t.daysOverdue-e.daysOverdue),{buckets:a,list:n}},[V,e,t]),q=(0,n.useMemo)(()=>t||!e?[]:V.map(e=>{const t=Number(e.totalRepayable||0)-Number(e.repaidAmount||0);return{"Loan ID":e.id,"Borrower Name":e.borrower,"Phone Number":e.phone,"Principal Amount (ZMW)":Number(e.principal||0).toFixed(2),"Interest Amount (ZMW)":Number(e.interest||0).toFixed(2),"Total Repayable (ZMW)":Number(e.totalRepayable||0).toFixed(2),"Amount Repaid (ZMW)":Number(e.repaidAmount||0).toFixed(2),"Outstanding Balance (ZMW)":t.toFixed(2),"Start Date":e.startDate,"Due Date":e.dueDate,Status:ee(e),"Days Overdue":"Overdue"===ee(e)?K()().diff(K()(e.dueDate),"day"):0}}),[V,e,t]),J=(0,n.useCallback)(()=>{const e=[{Metric:"Total Loans (Selected Period)",Value:E.totalLoans},{Metric:"Active Loans (Selected Period)",Value:E.activeLoans},{Metric:"Paid Loans (Selected Period)",Value:E.paidLoans},{Metric:"Overdue Loans (Selected Period)",Value:E.overdueLoans},{Metric:"Total Principal Disbursed",Value:E.totalPrincipalDisbursed.toFixed(2)},{Metric:"Total Interest Accrued",Value:E.totalInterestAccrued.toFixed(2)},{Metric:"Total Outstanding Balance",Value:E.totalOutstanding.toFixed(2)},{Metric:"Total Amount Repaid",Value:E.totalRepaid.toFixed(2)}];(0,G.y)("Loan_Portfolio_Summary_".concat(K()().format("YYYYMMDD"),".csv"),e)},[E]),Q=(0,n.useCallback)(()=>{const e=z.list.map(e=>({Borrower:e.borrower,Phone:e.phone,Principal:e.principal.toFixed(2),Interest:e.interest.toFixed(2),"Total Repayable":e.totalRepayable.toFixed(2),"Repaid Amount":e.repaidAmount.toFixed(2),Outstanding:e.outstanding.toFixed(2),"Start Date":e.startDate,"Due Date":e.dueDate,"Days Overdue":e.daysOverdue}));(0,G.y)("Arrears_Aging_Report_".concat(K()().format("YYYYMMDD"),".csv"),e)},[z]),$=(0,n.useCallback)(()=>{(0,G.y)("Detailed_Loan_List_".concat(K()().format("YYYYMMDD"),".csv"),q)},[q]),te={"& .MuiOutlinedInput-root":{"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:x.palette.secondary.main}},"& .MuiInputLabel-root.Mui-focused":{color:x.palette.secondary.main},"& .MuiSvgIcon-root":{"&.Mui-focused":{color:x.palette.secondary.main}}};return(0,y.jsxs)(l.A,{sx:{p:g?1:3},children:[(0,y.jsx)(d.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Reports & Analytics"}),(0,y.jsx)(c.A,{elevation:1,sx:{p:2,mb:3},children:(0,y.jsxs)(u.A,{direction:g?"column":"row",spacing:2,alignItems:"center",children:[(0,y.jsxs)(w.A,{size:"small",sx:(0,a.A)({minWidth:200},te),children:[(0,y.jsx)(C.A,{children:"Report Type"}),(0,y.jsxs)(N.A,{value:b,label:"Report Type",onChange:e=>j(e.target.value),children:[(0,y.jsx)(F.A,{value:"portfolioSummary",children:"Loan Portfolio Summary"}),(0,y.jsx)(F.A,{value:"arrearsAging",children:"Arrears Aging Report"}),(0,y.jsx)(F.A,{value:"detailedLoanList",children:"Detailed Loan List"})]})]}),(0,y.jsx)(W.A,{sx:te,label:"Start Date",type:"date",size:"small",fullWidth:g,value:f,onChange:e=>v(e.target.value),InputLabelProps:{shrink:!0}}),(0,y.jsx)(W.A,{sx:te,label:"End Date",type:"date",size:"small",fullWidth:g,value:D,onChange:e=>M(e.target.value),InputLabelProps:{shrink:!0}}),"detailedLoanList"===b&&(0,y.jsxs)(u.A,{direction:"row",spacing:1,sx:{ml:g?0:2},children:[(0,y.jsx)(H,{control:(0,y.jsx)(U.A,{checked:B,onChange:e=>I(e.target.checked),size:"small",sx:{"&.Mui-checked":{color:x.palette.secondary.main}}}),label:"Active"}),(0,y.jsx)(H,{control:(0,y.jsx)(U.A,{checked:Y,onChange:e=>T(e.target.checked),size:"small",sx:{"&.Mui-checked":{color:x.palette.secondary.main}}}),label:"Paid"}),(0,y.jsx)(H,{control:(0,y.jsx)(U.A,{checked:Z,onChange:e=>_(e.target.checked),size:"small",sx:{"&.Mui-checked":{color:x.palette.secondary.main}}}),label:"Overdue"})]})]})}),(()=>{if(t)return(0,y.jsxs)(l.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"300px",children:[(0,y.jsx)(s.A,{}),(0,y.jsx)(d.A,{ml:2,color:"text.secondary",children:"Loading loan data for reports..."})]});if(0===V.length&&"portfolioSummary"!==b)return(0,y.jsx)(d.A,{variant:"h6",align:"center",mt:4,color:"text.secondary",children:"No loan data found for the selected filters."});switch(b){case"portfolioSummary":return(0,y.jsxs)(l.A,{children:[(0,y.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:"Loan Portfolio Summary"}),(0,y.jsx)(c.A,{elevation:1,sx:{p:2,mb:3},children:(0,y.jsxs)(u.A,{direction:"column",spacing:1,children:[(0,y.jsxs)(d.A,{variant:"subtitle1",fontWeight:"bold",children:["Summary for Loans from ",K()(f).format("DD MMM YYYY")," to ",K()(D).format("DD MMM YYYY")]}),(0,y.jsx)(h.A,{}),(0,y.jsxs)(d.A,{children:["Total Loans: ",(0,y.jsx)(d.A,{component:"span",fontWeight:"bold",color:"secondary.main",children:E.totalLoans})]}),(0,y.jsxs)(d.A,{children:["Active Loans: ",(0,y.jsx)(d.A,{component:"span",fontWeight:"bold",color:"secondary.main",children:E.activeLoans})]}),(0,y.jsxs)(d.A,{children:["Paid Loans: ",(0,y.jsx)(d.A,{component:"span",fontWeight:"bold",color:"secondary.main",children:E.paidLoans})]}),(0,y.jsxs)(d.A,{children:["Overdue Loans: ",(0,y.jsx)(d.A,{component:"span",fontWeight:"bold",color:"secondary.main",children:E.overdueLoans})]}),(0,y.jsx)(h.A,{}),(0,y.jsxs)(d.A,{children:["Total Principal Disbursed: ",(0,y.jsxs)(d.A,{component:"span",fontWeight:"bold",color:"secondary.main",children:["ZMW ",E.totalPrincipalDisbursed.toFixed(2)]})]}),(0,y.jsxs)(d.A,{children:["Total Interest Accrued: ",(0,y.jsxs)(d.A,{component:"span",fontWeight:"bold",color:"secondary.main",children:["ZMW ",E.totalInterestAccrued.toFixed(2)]})]}),(0,y.jsxs)(d.A,{children:["Total Outstanding Balance: ",(0,y.jsxs)(d.A,{component:"span",fontWeight:"bold",color:"secondary.main",children:["ZMW ",E.totalOutstanding.toFixed(2)]})]}),(0,y.jsxs)(d.A,{children:["Total Amount Repaid: ",(0,y.jsxs)(d.A,{component:"span",fontWeight:"bold",color:"secondary.main",children:["ZMW ",E.totalRepaid.toFixed(2)]})]})]})}),(0,y.jsx)(m.A,{variant:"outlined",color:"secondary",onClick:J,children:"Export Summary CSV"})]});case"arrearsAging":return(0,y.jsxs)(l.A,{children:[(0,y.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:"Arrears Aging Report"}),(0,y.jsx)(L,{component:c.A,elevation:1,sx:{mb:3},children:(0,y.jsxs)(P.A,{size:"small",children:[(0,y.jsx)(O.A,{children:(0,y.jsxs)(R.A,{children:[(0,y.jsx)(S.A,{children:"Bucket"}),(0,y.jsx)(S.A,{align:"right",children:"Number of Loans"}),(0,y.jsx)(S.A,{align:"right",children:"Total Outstanding (ZMW)"})]})}),(0,y.jsx)(k.A,{children:Object.entries(z.buckets).map(e=>{let[t,r]=e;return(0,y.jsxs)(R.A,{children:[(0,y.jsx)(S.A,{children:t}),(0,y.jsx)(S.A,{align:"right",children:r.length}),(0,y.jsx)(S.A,{align:"right",children:r.reduce((e,t)=>e+t.outstanding,0).toFixed(2)})]},t)})})]})}),(0,y.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:"Detailed Overdue Loans List"}),0===z.list.length?(0,y.jsx)(d.A,{color:"text.secondary",children:"No overdue loans found based on current filters."}):(0,y.jsx)(L,{component:c.A,elevation:1,children:(0,y.jsxs)(P.A,{size:"small",children:[(0,y.jsx)(O.A,{children:(0,y.jsxs)(R.A,{children:[(0,y.jsx)(S.A,{children:"Borrower"}),(0,y.jsx)(S.A,{children:"Phone"}),(0,y.jsx)(S.A,{align:"right",children:"Principal"}),(0,y.jsx)(S.A,{align:"right",children:"Interest"}),(0,y.jsx)(S.A,{align:"right",children:"Total Repayable"}),(0,y.jsx)(S.A,{align:"right",children:"Repaid Amount"}),(0,y.jsx)(S.A,{align:"right",children:"Outstanding"}),(0,y.jsx)(S.A,{children:"Start Date"}),(0,y.jsx)(S.A,{children:"Due Date"}),(0,y.jsx)(S.A,{align:"right",children:"Days Overdue"})]})}),(0,y.jsx)(k.A,{children:z.list.map(e=>(0,y.jsxs)(R.A,{children:[(0,y.jsx)(S.A,{children:e.borrower}),(0,y.jsx)(S.A,{children:e.phone}),(0,y.jsx)(S.A,{align:"right",children:e.principal.toFixed(2)}),(0,y.jsx)(S.A,{align:"right",children:e.interest.toFixed(2)}),(0,y.jsx)(S.A,{align:"right",children:e.totalRepayable.toFixed(2)}),(0,y.jsx)(S.A,{align:"right",children:e.repaidAmount.toFixed(2)}),(0,y.jsx)(S.A,{align:"right",children:e.outstanding.toFixed(2)}),(0,y.jsx)(S.A,{children:e.startDate}),(0,y.jsx)(S.A,{children:e.dueDate}),(0,y.jsx)(S.A,{align:"right",children:e.daysOverdue})]},e.id))})]})}),(0,y.jsx)(m.A,{variant:"outlined",color:"secondary",sx:{mt:2},onClick:Q,children:"Export Arrears CSV"})]});case"detailedLoanList":return(0,y.jsxs)(l.A,{children:[(0,y.jsx)(d.A,{variant:"h6",gutterBottom:!0,children:"Detailed Loan List"}),0===q.length?(0,y.jsx)(d.A,{color:"text.secondary",children:"No loans found for the selected filters."}):(0,y.jsx)(L,{component:c.A,elevation:1,children:(0,y.jsxs)(P.A,{size:"small",children:[(0,y.jsx)(O.A,{children:(0,y.jsxs)(R.A,{children:[(0,y.jsx)(S.A,{children:"Borrower"}),(0,y.jsx)(S.A,{children:"Phone"}),(0,y.jsx)(S.A,{align:"right",children:"Principal"}),(0,y.jsx)(S.A,{align:"right",children:"Interest"}),(0,y.jsx)(S.A,{align:"right",children:"Total Repayable"}),(0,y.jsx)(S.A,{align:"right",children:"Amount Repaid"}),(0,y.jsx)(S.A,{align:"right",children:"Outstanding"}),(0,y.jsx)(S.A,{children:"Start Date"}),(0,y.jsx)(S.A,{children:"Due Date"}),(0,y.jsx)(S.A,{children:"Status"}),(0,y.jsx)(S.A,{align:"right",children:"Days Overdue"})]})}),(0,y.jsx)(k.A,{children:q.map(e=>(0,y.jsxs)(R.A,{children:[(0,y.jsx)(S.A,{children:e["Borrower Name"]}),(0,y.jsx)(S.A,{children:e["Phone Number"]}),(0,y.jsx)(S.A,{align:"right",children:e["Principal Amount (ZMW)"]}),(0,y.jsx)(S.A,{align:"right",children:e["Interest Amount (ZMW)"]}),(0,y.jsx)(S.A,{align:"right",children:e["Total Repayable (ZMW)"]}),(0,y.jsx)(S.A,{align:"right",children:e["Amount Repaid (ZMW)"]}),(0,y.jsx)(S.A,{align:"right",children:e["Outstanding Balance (ZMW)"]}),(0,y.jsx)(S.A,{children:e["Start Date"]}),(0,y.jsx)(S.A,{children:e["Due Date"]}),(0,y.jsx)(S.A,{children:e.Status}),(0,y.jsx)(S.A,{align:"right",children:e["Days Overdue"]})]},e["Loan ID"]))})]})}),(0,y.jsx)(m.A,{variant:"outlined",color:"secondary",sx:{mt:2},onClick:$,children:"Export Detailed List CSV"})]});default:return(0,y.jsx)(d.A,{children:"Select a report type from the dropdown to view data."})}})()]})}}}]);
//# sourceMappingURL=16.3f4e6a29.chunk.js.map