"use strict";(self.webpackChunkloan_management_pwa=self.webpackChunkloan_management_pwa||[]).push([[295],{20:(e,t,n)=>{function i(e,t){if(!t||!t.length)return;const n=Object.keys(t[0]),i=n.join(",")+"\n"+t.map(e=>n.map(t=>{let n=null===e[t]||void 0===e[t]?"":e[t];return n=n.toString().replace(/"/g,'""'),n.search(/("|,|\n)/g)>=0&&(n='"'.concat(n,'"')),n}).join(",")).join("\n"),a=new Blob([i],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,e);else{const t=document.createElement("a");if(void 0!==t.download){const n=URL.createObjectURL(a);t.setAttribute("href",n),t.setAttribute("download",e),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}}n.d(t,{y:()=>i})},97295:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ie});var i=n(89379),a=n(65043),s=n(53969),l=n(70298),r=n(73849),o=n(87443),d=n(10756),c=n(86172),h=n(81341),x=n(34375),p=n(55895),u=n(24343),A=n(33699),j=n(42579),g=n(10256),m=n(79067),b=n(67203),y=n(47471),v=n(12097),w=n(80172),f=n(83759),C=n(19e3),k=n(26529),D=n(26711),z=n(41778),S=n(51692),W=n(38517),I=n(81911),M=n(78776),L=n(85877),R=n(91449),P=n(70916),F=n(60267),N=n(86995),E=n(71530),Y=n(27421),B=n(5362),O=n(61773),T=n(99161),H=n(3555),Z=n(76678),q=n(75067),V=n(59267),_=n(20),U=n(23546),G=n(46446),J=n(60446),K=n.n(J),Q=n(73537),X=n(41729),$=n(70579);const ee=10,te=[{label:"1 Week",value:1},{label:"2 Weeks",value:2},{label:"3 Weeks",value:3},{label:"4 Weeks",value:4}],ne=e=>{let{isMobile:t}=e;const n=(0,F.A)(),i=Array.from({length:ee});return t?(0,$.jsx)(s.A,{children:i.map((e,t)=>(0,$.jsx)(s.A,{sx:{marginBottom:12,boxShadow:n.shadows[1],borderRadius:n.shape.borderRadius,borderLeft:"5px solid ".concat(n.palette.secondary.main),padding:12,background:n.palette.background.paper},children:(0,$.jsxs)(l.A,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:1,children:[(0,$.jsxs)(s.A,{flexGrow:1,minWidth:0,children:[(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20}),(0,$.jsx)(r.A,{variant:"text",width:"60%",height:15})]}),(0,$.jsxs)(l.A,{alignItems:"flex-end",spacing:.5,children:[(0,$.jsx)(r.A,{variant:"rectangular",width:60,height:20}),(0,$.jsx)(r.A,{variant:"text",width:80,height:20})]}),(0,$.jsx)(r.A,{variant:"circular",width:24,height:24})]})},t))}):(0,$.jsxs)(o.A,{stickyHeader:!0,size:"small",sx:{tableLayout:"fixed",minWidth:900},children:[(0,$.jsx)(d.A,{children:(0,$.jsxs)(c.A,{children:[(0,$.jsx)(h.A,{padding:"checkbox",sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"rectangular",width:20,height:20})}),(0,$.jsx)(h.A,{align:"center",sx:{width:30,py:.5},children:(0,$.jsx)(r.A,{variant:"text",width:20,height:20})}),(0,$.jsx)(h.A,{sx:{width:140},children:(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20})}),(0,$.jsx)(h.A,{sx:{width:110},children:(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20})}),(0,$.jsx)(h.A,{align:"right",sx:{width:90},children:(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20})}),(0,$.jsx)(h.A,{align:"right",sx:{width:90},children:(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20})}),(0,$.jsx)(h.A,{align:"right",sx:{width:110},children:(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20})}),(0,$.jsx)(h.A,{align:"right",sx:{width:110},children:(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20})}),(0,$.jsx)(h.A,{sx:{width:100},children:(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20})}),(0,$.jsx)(h.A,{sx:{width:100},children:(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20})}),(0,$.jsx)(h.A,{sx:{width:90},children:(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20})}),(0,$.jsx)(h.A,{align:"center",sx:{width:120},children:(0,$.jsx)(r.A,{variant:"text",width:"80%",height:20})})]})}),(0,$.jsx)(x.A,{children:i.map((e,t)=>(0,$.jsxs)(c.A,{sx:{py:.5},children:[(0,$.jsx)(h.A,{padding:"checkbox",sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"rectangular",width:20,height:20})}),(0,$.jsx)(h.A,{align:"center",sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"text",width:20,height:20})}),(0,$.jsx)(h.A,{sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"text",width:"90%",height:20})}),(0,$.jsx)(h.A,{sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"text",width:"90%",height:20})}),(0,$.jsx)(h.A,{align:"right",sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"text",width:"90%",height:20})}),(0,$.jsx)(h.A,{align:"right",sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"text",width:"90%",height:20})}),(0,$.jsx)(h.A,{align:"right",sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"text",width:"90%",height:20})}),(0,$.jsx)(h.A,{align:"right",sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"text",width:"90%",height:20})}),(0,$.jsx)(h.A,{sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"text",width:"90%",height:20})}),(0,$.jsx)(h.A,{sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"text",width:"90%",height:20})}),(0,$.jsx)(h.A,{sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"rectangular",width:50,height:20})}),(0,$.jsx)(h.A,{align:"center",sx:{py:.5},children:(0,$.jsx)(r.A,{variant:"rectangular",width:80,height:20})})]},t))})]})};function ie(e){let{globalSearchTerm:t}=e;const{loans:n,loadingLoans:r,deleteLoan:J,addPayment:ie,updateLoan:ae,getPaymentsByLoanId:se,settings:le}=(0,V.j)(),re=(0,F.A)(),oe=(0,N.A)(re.breakpoints.down("sm")),[de,ce]=(0,Q.ok)(),[he,xe]=(0,a.useState)(""),[pe,ue]=(0,a.useState)(de.get("filter")||"all"),[Ae,je]=(0,a.useState)(de.get("month")||K()().format("YYYY-MM")),[ge,me]=(0,a.useState)(1),[be]=(0,a.useState)(oe),[ye,ve]=(0,a.useState)(null),[we,fe]=(0,a.useState)({open:!1,loanId:null}),[Ce,ke]=(0,a.useState)(!1),[De,ze]=(0,a.useState)({open:!1,loanId:null}),[Se,We]=(0,a.useState)(""),[Ie,Me]=(0,a.useState)(""),[Le,Re]=(0,a.useState)(!1),[Pe,Fe]=(0,a.useState)(!1),[Ne,Ee]=(0,a.useState)({open:!1,loan:null}),[Ye,Be]=(0,a.useState)({borrower:"",phone:"",principal:"",interestDuration:1,startDate:"",dueDate:""}),[Oe,Te]=(0,a.useState)({}),[He,Ze]=(0,a.useState)(!1),[qe,Ve]=(0,a.useState)({open:!1,loanId:null,payments:[],loading:!1}),[_e,Ue]=(0,a.useState)([]),[Ge,Je]=(0,a.useState)(!1),[Ke,Qe]=(0,a.useState)(!1),[Xe,$e]=(0,a.useState)("startDate"),[et,tt]=(0,a.useState)("desc"),nt=le.interestRates||{1:.15,2:.2,3:.3,4:.3},it=(e,t)=>e*(nt[t]||0),at=e=>{const t=Number(e.totalRepayable||0);if(Number(e.repaidAmount||0)>=t&&t>0)return"Paid";const n=K()();return K()(e.dueDate).isBefore(n,"day")?"Overdue":"Active"},st=e=>{switch(e.toLowerCase()){case"paid":return{label:"Paid",color:"success"};case"overdue":return{label:"Overdue",color:"error"};default:return{label:"Active",color:"primary"}}},lt={"& .MuiOutlinedInput-root":{"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:re.palette.secondary.main},"& .MuiInputBase-input":{padding:"8.5px 14px"}},"& .MuiInputLabel-root.Mui-focused":{color:re.palette.secondary.main},"& .MuiSvgIcon-root":{"&.Mui-focused":{color:re.palette.secondary.main}},"& .MuiInputLabel-root":{fontSize:"0.875rem",transform:"translate(14px, 8.5px) scale(1)"},"& .MuiInputLabel-shrink":{transform:"translate(14px, -9px) scale(0.75)"}};(0,a.useEffect)(()=>{const e=de.get("filter"),n=de.get("month");e&&e.toLowerCase()!==pe.toLowerCase()?ue(e):e||"all"===pe||ue("all"),n&&n!==Ae?je(n):n||Ae===K()().format("YYYY-MM")||je("2024-03"),xe(t||""),me(1)},[de,pe,Ae,t]);const rt=(0,a.useMemo)(()=>t||he,[t,he]),ot=(0,a.useMemo)(()=>{let e=n.filter(e=>(!Ae||K()(e.startDate).format("YYYY-MM")===Ae)&&(("all"===pe||at(e).toLowerCase()===pe.toLowerCase())&&!(rt&&!e.borrower.toLowerCase().includes(rt.toLowerCase())&&!e.phone.toLowerCase().includes(rt.toLowerCase()))));return Xe&&e.sort((e,t)=>{let n=e[Xe],i=t[Xe];return"borrower"===Xe||"phone"===Xe?(n=n.toLowerCase(),i=i.toLowerCase()):Xe.includes("Date")?(n=K()(n).unix(),i=K()(i).unix()):"outstanding"===Xe?(n=(e.totalRepayable||0)-(e.repaidAmount||0),i=(t.totalRepayable||0)-(t.repaidAmount||0)):(n=Number(n),i=Number(i)),n<i?"asc"===et?-1:1:n>i?"asc"===et?1:-1:0}),e},[n,rt,pe,Ae,Xe,et]),dt=(0,a.useMemo)(()=>{if(be&&oe)return ot.slice(0,ge*ee);{const e=(ge-1)*ee;return ot.slice(e,e+ee)}},[ot,ge,be,oe]),ct=(0,a.useCallback)(()=>{window.innerHeight+window.scrollY+50>=document.documentElement.scrollHeight&&be&&dt.length<ot.length&&!r&&me(e=>e+1)},[dt.length,ot.length,be,r]);(0,a.useEffect)(()=>{if(be&&oe)return window.addEventListener("scroll",ct),()=>window.removeEventListener("scroll",ct)},[ct,be,oe]),(0,a.useEffect)(()=>{me(1),ve(null),Ue([])},[rt,pe,Ae,be]);const ht=(0,a.useMemo)(()=>ot.reduce((e,t)=>(e.principal+=Number(t.principal||0),e.interest+=Number(t.interest||0),e.totalRepayable+=Number(t.totalRepayable||0),e.outstanding+=Number(t.totalRepayable||0)-Number(t.repaidAmount||0),e),{principal:0,interest:0,totalRepayable:0,outstanding:0}),[ot]),xt=e=>{tt(Xe===e&&"asc"===et?"desc":"asc"),$e(e)},pt=e=>{Be({borrower:e.borrower,phone:e.phone,principal:e.principal,interestDuration:e.interestDuration||1,startDate:e.startDate,dueDate:e.dueDate}),Te({}),Ee({open:!0,loan:e})},ut=e=>{We(""),Me(""),ze({open:!0,loanId:e})},At=async e=>{Ve({open:!0,loanId:e,payments:[],loading:!0});try{const t=await se(e);Ve(e=>(0,i.A)((0,i.A)({},e),{},{payments:t,loading:!1}))}catch(t){console.error("Error fetching payment history:",t),Ve(e=>(0,i.A)((0,i.A)({},e),{},{payments:[],loading:!1}))}},jt=(0,a.useCallback)(e=>{const t=e.target.value;t?de.set("month",t):de.delete("month"),ce(de)},[de,ce]),gt=(0,a.useCallback)(e=>{const t=e.target.value;"all"===t?de.delete("filter"):de.set("filter",t),ce(de)},[de,ce]);return(0,$.jsxs)(s.A,{sx:{p:oe?1:2},children:[(0,$.jsx)(p.A,{variant:"h6",component:"h1",gutterBottom:!0,fontWeight:"bold",sx:{mb:1},children:"Loan Records"}),(0,$.jsxs)(l.A,{direction:oe?"column":"row",spacing:1,mb:2,alignItems:"center",children:[(0,$.jsx)(u.A,{label:"Search",value:he,onChange:e=>xe(e.target.value),size:"small",sx:(0,i.A)((0,i.A)({},lt),{},{minWidth:160}),variant:"outlined",margin:"dense",disabled:!!t,helperText:t?"Using global search":"",InputProps:{endAdornment:he&&!t&&(0,$.jsx)(A.A,{position:"end",children:(0,$.jsx)(j.A,{size:"small",onClick:()=>xe(""),"aria-label":"clear search",children:(0,$.jsx)(Y.A,{fontSize:"small"})})})}}),(0,$.jsxs)(g.A,{size:"small",sx:(0,i.A)((0,i.A)({},lt),{},{minWidth:130}),children:[(0,$.jsx)(m.A,{children:"Status"}),(0,$.jsxs)(b.A,{value:pe,label:"Status",onChange:gt,margin:"dense",children:[(0,$.jsx)(y.A,{value:"all",children:"All"}),(0,$.jsx)(y.A,{value:"active",children:"Active"}),(0,$.jsx)(y.A,{value:"paid",children:"Paid"}),(0,$.jsx)(y.A,{value:"overdue",children:"Overdue"})]})]}),(0,$.jsx)(u.A,{label:"Month",type:"month",size:"small",value:Ae,onChange:jt,sx:(0,i.A)((0,i.A)({},lt),{},{maxWidth:130}),margin:"dense"}),(0,$.jsx)(v.A,{variant:"outlined",color:"secondary",size:"small",onClick:()=>(0,_.y)("loans.csv",ot),sx:{height:32},children:"Export CSV"}),_e.length>0&&(0,$.jsx)(v.A,{variant:"contained",color:"error",size:"small",onClick:()=>Je(!0),sx:{height:32},disabled:Ke,children:Ke?(0,$.jsx)(w.A,{size:20,color:"inherit"}):"Delete (".concat(_e.length,")")})]}),r?(0,$.jsx)(ne,{isMobile:oe}):(0,$.jsxs)($.Fragment,{children:[oe?(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(U.N,{children:dt.map(e=>{const t=(e.totalRepayable||0)-(e.repaidAmount||0),n="paid"===at(e).toLowerCase();return(0,$.jsxs)(G.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},layout:!0,style:{marginBottom:12,boxShadow:re.shadows[1],borderRadius:re.shape.borderRadius,borderLeft:"5px solid ".concat(re.palette.secondary.main),padding:12,background:re.palette.background.paper},children:[(0,$.jsxs)(l.A,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:1,children:[(0,$.jsxs)(s.A,{flexGrow:1,minWidth:0,children:[(0,$.jsx)(p.A,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:e.borrower}),(0,$.jsx)(p.A,{variant:"caption",color:"textSecondary",noWrap:!0,children:e.phone})]}),(0,$.jsxs)(l.A,{alignItems:"flex-end",spacing:.5,children:[(0,$.jsx)(f.A,(0,i.A)({size:"small"},st(at(e)))),(0,$.jsxs)(p.A,{variant:"body2",fontWeight:"bold",sx:{color:re.palette.secondary.main},noWrap:!0,children:["ZMW ",t.toFixed(2)]})]}),(0,$.jsx)(j.A,{size:"small",onClick:()=>{return t=e.id,void ve(ye===t?null:t);var t},"aria-label":"expand",color:"secondary",children:ye===e.id?(0,$.jsx)(Z.A,{fontSize:"small"}):(0,$.jsx)(H.A,{fontSize:"small"})})]}),(0,$.jsx)(C.A,{in:ye===e.id,timeout:"auto",unmountOnExit:!0,children:(0,$.jsxs)(s.A,{mt:1,fontSize:"0.8rem",sx:{color:re.palette.text.secondary},children:[(0,$.jsxs)(p.A,{noWrap:!0,children:["Principal: ZMW ",Number(e.principal).toFixed(2)]}),(0,$.jsxs)(p.A,{noWrap:!0,children:["Interest: ZMW ",Number(e.interest).toFixed(2)]}),(0,$.jsxs)(p.A,{noWrap:!0,children:["Total Repayable: ZMW ",Number(e.totalRepayable).toFixed(2)]}),(0,$.jsxs)(p.A,{noWrap:!0,children:["Outstanding: ",(0,$.jsx)(p.A,{component:"span",fontWeight:"bold",color:"secondary.main",children:t.toFixed(2)})]}),(0,$.jsxs)(p.A,{noWrap:!0,children:["Start: ",e.startDate]}),(0,$.jsxs)(p.A,{noWrap:!0,children:["Due: ",e.dueDate]}),(0,$.jsxs)(l.A,{direction:"row",spacing:.5,mt:1,justifyContent:"flex-start",children:[(0,$.jsx)(k.A,{title:"Edit",children:(0,$.jsx)("span",{children:(0,$.jsx)(j.A,{size:"small",onClick:()=>pt(e),"aria-label":"edit",disabled:n,color:"secondary",children:(0,$.jsx)(O.A,{fontSize:"small"})})})}),(0,$.jsx)(k.A,{title:"Delete",children:(0,$.jsx)("span",{children:(0,$.jsx)(j.A,{size:"small",color:"error",onClick:()=>fe({open:!0,loanId:e.id}),"aria-label":"delete",disabled:n,children:(0,$.jsx)(B.A,{fontSize:"small"})})})}),(0,$.jsx)(k.A,{title:"Add Payment",children:(0,$.jsx)("span",{children:(0,$.jsx)(j.A,{size:"small",onClick:()=>ut(e.id),"aria-label":"payment",disabled:n,color:"secondary",children:(0,$.jsx)(q.A,{fontSize:"small"})})})}),(0,$.jsx)(k.A,{title:"View History",children:(0,$.jsx)(j.A,{size:"small",onClick:()=>At(e.id),"aria-label":"history",color:"secondary",children:(0,$.jsx)(T.A,{fontSize:"small"})})})]})]})})]},e.id)})}),be&&dt.length<ot.length&&(0,$.jsxs)(s.A,{textAlign:"center",my:1,children:[(0,$.jsx)(w.A,{size:24}),(0,$.jsx)(p.A,{variant:"caption",display:"block",mt:.5,color:"text.secondary",children:"Loading more..."})]})]}):(0,$.jsxs)($.Fragment,{children:[(0,$.jsxs)(o.A,{stickyHeader:!0,size:"small",sx:{tableLayout:"fixed",minWidth:900},children:[(0,$.jsx)(d.A,{sx:{backgroundColor:re.palette.background.paper},children:(0,$.jsxs)(c.A,{children:[(0,$.jsx)(h.A,{padding:"checkbox",sx:{py:.5},children:(0,$.jsx)(D.A,{checked:_e.length===dt.length&&dt.length>0,indeterminate:_e.length>0&&_e.length<dt.length,onChange:()=>{_e.length===dt.length&&dt.length>0?Ue([]):Ue(dt.map(e=>e.id))},inputProps:{"aria-label":"select all loans"},size:"small",sx:{"&.Mui-checked":{color:re.palette.secondary.main}}})}),(0,$.jsx)(h.A,{align:"center",sx:{width:30,py:.5},children:"#"}),(0,$.jsx)(h.A,{sx:{width:140},sortDirection:"borrower"===Xe&&et,children:(0,$.jsxs)(z.A,{active:"borrower"===Xe,direction:"borrower"===Xe?et:"asc",onClick:()=>xt("borrower"),children:["Borrower","borrower"===Xe?(0,$.jsx)(s.A,{component:"span",sx:X.A,children:"desc"===et?"sorted descending":"sorted ascending"}):null]})}),(0,$.jsx)(h.A,{sx:{width:110},sortDirection:"phone"===Xe&&et,children:(0,$.jsxs)(z.A,{active:"phone"===Xe,direction:"phone"===Xe?et:"asc",onClick:()=>xt("phone"),children:["Phone","phone"===Xe?(0,$.jsx)(s.A,{component:"span",sx:X.A,children:"desc"===et?"sorted descending":"sorted ascending"}):null]})}),(0,$.jsx)(h.A,{align:"right",sx:{width:90},sortDirection:"principal"===Xe&&et,children:(0,$.jsxs)(z.A,{active:"principal"===Xe,direction:"principal"===Xe?et:"asc",onClick:()=>xt("principal"),children:["Principal","principal"===Xe?(0,$.jsx)(s.A,{component:"span",sx:X.A,children:"desc"===et?"sorted descending":"sorted ascending"}):null]})}),(0,$.jsx)(h.A,{align:"right",sx:{width:90},sortDirection:"interest"===Xe&&et,children:(0,$.jsxs)(z.A,{active:"interest"===Xe,direction:"interest"===Xe?et:"asc",onClick:()=>xt("interest"),children:["Interest","interest"===Xe?(0,$.jsx)(s.A,{component:"span",sx:X.A,children:"desc"===et?"sorted descending":"sorted ascending"}):null]})}),(0,$.jsx)(h.A,{align:"right",sx:{width:110},sortDirection:"totalRepayable"===Xe&&et,children:(0,$.jsxs)(z.A,{active:"totalRepayable"===Xe,direction:"totalRepayable"===Xe?et:"asc",onClick:()=>xt("totalRepayable"),children:["Total Repayable","totalRepayable"===Xe?(0,$.jsx)(s.A,{component:"span",sx:X.A,children:"desc"===et?"sorted descending":"sorted ascending"}):null]})}),(0,$.jsx)(h.A,{align:"right",sx:{width:110},sortDirection:"outstanding"===Xe&&et,children:(0,$.jsxs)(z.A,{active:"outstanding"===Xe,direction:"outstanding"===Xe?et:"asc",onClick:()=>xt("outstanding"),children:["Total Outstanding","outstanding"===Xe?(0,$.jsx)(s.A,{component:"span",sx:X.A,children:"desc"===et?"sorted descending":"sorted ascending"}):null]})}),(0,$.jsx)(h.A,{sx:{width:100},sortDirection:"startDate"===Xe&&et,children:(0,$.jsxs)(z.A,{active:"startDate"===Xe,direction:"startDate"===Xe?et:"asc",onClick:()=>xt("startDate"),children:["Start Date","startDate"===Xe?(0,$.jsx)(s.A,{component:"span",sx:X.A,children:"desc"===et?"sorted descending":"sorted ascending"}):null]})}),(0,$.jsx)(h.A,{sx:{width:100},sortDirection:"dueDate"===Xe&&et,children:(0,$.jsxs)(z.A,{active:"dueDate"===Xe,direction:"dueDate"===Xe?et:"asc",onClick:()=>xt("dueDate"),children:["Due Date","dueDate"===Xe?(0,$.jsx)(s.A,{component:"span",sx:X.A,children:"desc"===et?"sorted descending":"sorted ascending"}):null]})}),(0,$.jsx)(h.A,{sx:{width:90},children:"Status"}),(0,$.jsx)(h.A,{align:"center",sx:{width:120},children:"Actions"})]})}),(0,$.jsx)(x.A,{children:dt.map((e,t)=>{const n=(e.totalRepayable||0)-(e.repaidAmount||0),a=_e.includes(e.id),s="paid"===at(e).toLowerCase();return(0,$.jsxs)(c.A,{hover:!0,role:"checkbox","aria-checked":a,selected:a,sx:{cursor:"pointer",py:.5},children:[(0,$.jsx)(h.A,{padding:"checkbox",sx:{py:.5},children:(0,$.jsx)(D.A,{checked:a,onChange:()=>{return t=e.id,void Ue(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},inputProps:{"aria-label":"select loan ".concat(e.borrower)},size:"small",sx:{"&.Mui-checked":{color:re.palette.secondary.main}}})}),(0,$.jsx)(h.A,{align:"center",sx:{py:.5},children:(ge-1)*ee+t+1}),(0,$.jsx)(h.A,{sx:{py:.5},children:e.borrower}),(0,$.jsx)(h.A,{sx:{py:.5},children:e.phone}),(0,$.jsx)(h.A,{align:"right",sx:{py:.5},children:Number(e.principal).toFixed(2)}),(0,$.jsx)(h.A,{align:"right",sx:{py:.5},children:Number(e.interest).toFixed(2)}),(0,$.jsx)(h.A,{align:"right",sx:{py:.5},children:Number(e.totalRepayable).toFixed(2)}),(0,$.jsx)(h.A,{align:"right",sx:{py:.5},children:n.toFixed(2)}),(0,$.jsx)(h.A,{sx:{py:.5},children:e.startDate}),(0,$.jsx)(h.A,{sx:{py:.5},children:e.dueDate}),(0,$.jsx)(h.A,{sx:{py:.5},children:(0,$.jsx)(f.A,(0,i.A)({size:"small"},st(at(e))))}),(0,$.jsxs)(h.A,{align:"center",sx:{py:.5},children:[(0,$.jsx)(k.A,{title:"Edit",children:(0,$.jsx)("span",{children:(0,$.jsx)(j.A,{size:"small",onClick:()=>pt(e),"aria-label":"edit",disabled:s,color:"secondary",children:(0,$.jsx)(O.A,{fontSize:"small"})})})}),(0,$.jsx)(k.A,{title:"Delete",children:(0,$.jsx)("span",{children:(0,$.jsx)(j.A,{size:"small",color:"error",onClick:()=>fe({open:!0,loanId:e.id}),"aria-label":"delete",disabled:s,children:(0,$.jsx)(B.A,{fontSize:"small"})})})}),(0,$.jsx)(k.A,{title:"Add Payment",children:(0,$.jsx)("span",{children:(0,$.jsx)(j.A,{size:"small",onClick:()=>ut(e.id),"aria-label":"add payment",disabled:s,color:"secondary",children:(0,$.jsx)(q.A,{fontSize:"small"})})})}),(0,$.jsx)(k.A,{title:"View History",children:(0,$.jsx)(j.A,{size:"small",onClick:()=>At(e.id),"aria-label":"view history",color:"secondary",children:(0,$.jsx)(T.A,{fontSize:"small"})})})]})]},e.id)})}),(0,$.jsx)(S.A,{children:(0,$.jsxs)(c.A,{children:[(0,$.jsx)(h.A,{colSpan:4,align:"right",sx:{fontWeight:"bold",py:.5},children:"Totals:"}),(0,$.jsx)(h.A,{align:"right",sx:{fontWeight:"bold",py:.5,color:re.palette.secondary.main},children:ht.principal.toFixed(2)}),(0,$.jsx)(h.A,{align:"right",sx:{fontWeight:"bold",py:.5,color:re.palette.secondary.main},children:ht.interest.toFixed(2)}),(0,$.jsx)(h.A,{align:"right",sx:{fontWeight:"bold",py:.5,color:re.palette.secondary.main},children:ht.totalRepayable.toFixed(2)}),(0,$.jsx)(h.A,{align:"right",sx:{fontWeight:"bold",py:.5,color:re.palette.secondary.main},children:ht.outstanding.toFixed(2)}),(0,$.jsx)(h.A,{colSpan:4})]})})]}),!be&&(0,$.jsxs)(l.A,{direction:"row",justifyContent:"center",spacing:1,mt:1,mb:2,children:[(0,$.jsx)(v.A,{size:"small",color:"secondary",disabled:1===ge,onClick:()=>me(e=>Math.max(e-1,1)),children:"Previous"}),(0,$.jsxs)(p.A,{variant:"body2",sx:{alignSelf:"center",minWidth:70,textAlign:"center"},children:["Page ",ge," / ",Math.ceil(ot.length/ee)]}),(0,$.jsx)(v.A,{size:"small",color:"secondary",disabled:ge===Math.ceil(ot.length/ee),onClick:()=>me(e=>Math.min(e+1,Math.ceil(ot.length/ee))),children:"Next"})]})]}),!r&&0===ot.length&&(0,$.jsxs)(s.A,{textAlign:"center",mt:4,p:2,border:"1px dashed",borderColor:"grey.400",borderRadius:2,children:[(0,$.jsx)(p.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Loans Found"}),(0,$.jsx)(p.A,{variant:"body2",color:"text.secondary",mb:2,children:"It looks like there are no loans matching your current filters."}),(0,$.jsx)(v.A,{variant:"contained",color:"secondary",onClick:()=>ce({}),startIcon:(0,$.jsx)(E.A,{}),children:"Clear Filters & Add Loan"})]})]}),(0,$.jsxs)(W.A,{open:we.open,onClose:()=>fe({open:!1,loanId:null}),maxWidth:"xs",fullWidth:!0,children:[(0,$.jsx)(I.A,{fontSize:"1.1rem",children:"Confirm Delete"}),(0,$.jsx)(M.A,{sx:{pb:1},children:"Are you sure you want to delete this loan?"}),(0,$.jsxs)(L.A,{sx:{pb:1},children:[(0,$.jsx)(v.A,{size:"small",onClick:()=>fe({open:!1,loanId:null}),disabled:Ce,children:" Cancel "}),(0,$.jsxs)(v.A,{size:"small",color:"error",onClick:async()=>{if(we.loanId){ke(!0);try{await J(we.loanId),fe({open:!1,loanId:null}),Ue(e=>e.filter(e=>e!==we.loanId))}catch(e){console.error("Error deleting loan:",e)}finally{ke(!1)}}},disabled:Ce,children:[" ",Ce?(0,$.jsx)(w.A,{size:20,color:"inherit"}):"Delete"," "]})]})]}),(0,$.jsxs)(W.A,{open:Ge,onClose:()=>Je(!1),maxWidth:"xs",fullWidth:!0,children:[(0,$.jsx)(I.A,{fontSize:"1.1rem",children:"Confirm Bulk Delete"}),(0,$.jsxs)(M.A,{sx:{pb:1},children:["Are you sure you want to delete ",_e.length," selected loans? This action cannot be undone."]}),(0,$.jsxs)(L.A,{sx:{pb:1},children:[(0,$.jsx)(v.A,{size:"small",onClick:()=>Je(!1),disabled:Ke,children:" Cancel "}),(0,$.jsxs)(v.A,{size:"small",color:"error",onClick:async()=>{Qe(!0);try{await Promise.all(_e.map(e=>J(e))),Ue([]),Je(!1)}catch(e){console.error("Error bulk deleting loans:",e)}finally{Qe(!1)}},disabled:Ke,children:[" ",Ke?(0,$.jsx)(w.A,{size:20,color:"inherit"}):"Delete ".concat(_e.length," Loans")," "]})]})]}),(0,$.jsxs)(W.A,{open:De.open,onClose:()=>ze({open:!1,loanId:null}),maxWidth:"xs",fullWidth:!0,children:[(0,$.jsx)(I.A,{fontSize:"1.1rem",children:"Add Payment"}),(0,$.jsx)(M.A,{sx:{pb:1},children:(0,$.jsx)(u.A,{label:"Amount",type:"number",value:Se,onChange:e=>{We(e.target.value),Me("")},size:"small",autoFocus:!0,fullWidth:!0,error:!!Ie,helperText:Ie,sx:lt,InputProps:{startAdornment:(0,$.jsx)(A.A,{position:"start",children:"ZMW"})}})}),(0,$.jsxs)(L.A,{sx:{pb:1},children:[(0,$.jsx)(v.A,{size:"small",onClick:()=>ze({open:!1,loanId:null}),disabled:Le,children:" Cancel "}),(0,$.jsx)(v.A,{size:"small",variant:"contained",onClick:async()=>{const e=parseFloat(Se);if(isNaN(e)||e<=0)return void Me("Payment amount must be a positive number.");const t=n.find(e=>e.id===De.loanId),i=((null===t||void 0===t?void 0:t.totalRepayable)||0)-((null===t||void 0===t?void 0:t.repaidAmount)||0);if(e>i)Me("Payment cannot exceed outstanding amount (ZMW ".concat(i.toFixed(2),")."));else{Re(!0);try{await ie(De.loanId,e),ze({open:!1,loanId:null}),Fe(!0)}catch(a){console.error("Error adding payment:",a),Me("Failed to add payment. Please try again.")}finally{Re(!1)}}},disabled:Le,color:"secondary",children:Le?(0,$.jsx)(w.A,{size:20,color:"inherit"}):"Add Payment"})]})]}),(0,$.jsxs)(W.A,{open:Ne.open,onClose:()=>Ee({open:!1,loan:null}),maxWidth:"xs",fullWidth:!0,children:[(0,$.jsx)(I.A,{fontSize:"1.1rem",children:"Edit Loan"}),(0,$.jsxs)(M.A,{sx:{pb:1},children:[Oe.form&&(0,$.jsx)(R.A,{severity:"error",sx:{mb:2},children:Oe.form}),(0,$.jsxs)(l.A,{spacing:2,mt:1,children:[(0,$.jsx)(u.A,{label:"Borrower Name",size:"small",fullWidth:!0,value:Ye.borrower,onChange:e=>Be((0,i.A)((0,i.A)({},Ye),{},{borrower:e.target.value})),error:!!Oe.borrower,helperText:Oe.borrower,sx:lt}),(0,$.jsx)(u.A,{label:"Phone Number",size:"small",fullWidth:!0,value:Ye.phone,onChange:e=>Be((0,i.A)((0,i.A)({},Ye),{},{phone:e.target.value})),error:!!Oe.phone,helperText:Oe.phone,sx:lt}),(0,$.jsx)(u.A,{label:"Principal Amount",size:"small",type:"number",fullWidth:!0,value:Ye.principal,onChange:e=>{const t=parseFloat(e.target.value),n=it(t,Ye.interestDuration),a=t+n;Be((0,i.A)((0,i.A)({},Ye),{},{principal:e.target.value,interest:n,totalRepayable:a}))},error:!!Oe.principal,helperText:Oe.principal,sx:lt,InputProps:{startAdornment:(0,$.jsx)(A.A,{position:"start",children:"ZMW"})}}),(0,$.jsxs)(g.A,{size:"small",fullWidth:!0,sx:lt,children:[(0,$.jsx)(m.A,{children:"Interest Duration"}),(0,$.jsx)(b.A,{value:Ye.interestDuration,label:"Interest Duration",onChange:e=>{const t=e.target.value,n=parseFloat(Ye.principal),a=it(n,t),s=n+a;Be((0,i.A)((0,i.A)({},Ye),{},{interestDuration:t,interest:a,totalRepayable:s}))},children:te.map(e=>{const t=100*(le.interestRates[e.value]||0);return(0,$.jsxs)(y.A,{value:e.value,children:[e.label," (",t.toFixed(0),"%)"]},e.value)})})]}),(0,$.jsx)(u.A,{label:"Start Date",type:"date",size:"small",fullWidth:!0,InputLabelProps:{shrink:!0},value:Ye.startDate,onChange:e=>{const t=e.target.value;Be((0,i.A)((0,i.A)({},Ye),{},{startDate:t}))},error:!!Oe.startDate,helperText:Oe.startDate,sx:lt}),(0,$.jsx)(u.A,{label:"Due Date",type:"date",size:"small",fullWidth:!0,InputLabelProps:{shrink:!0},value:Ye.dueDate,onChange:e=>{const t=e.target.value;Be((0,i.A)((0,i.A)({},Ye),{},{dueDate:t}))},sx:lt})]})]}),(0,$.jsxs)(L.A,{sx:{pb:1},children:[(0,$.jsx)(v.A,{size:"small",onClick:()=>Ee({open:!1,loan:null}),disabled:He,children:"Cancel"}),(0,$.jsx)(v.A,{size:"small",variant:"contained",onClick:async()=>{const e={};if(Ye.borrower||(e.borrower="Borrower name is required."),Ye.phone||(e.phone="Phone number is required."),(isNaN(parseFloat(Ye.principal))||parseFloat(Ye.principal)<0)&&(e.principal="Valid principal required."),Ye.startDate||(e.startDate="Start date is required."),Te(e),Object.keys(e).length>0)return;const t=parseFloat(Ye.principal),n=Ye.interestDuration,a=it(t,n),s=t+a,l=(0,i.A)((0,i.A)({},Ne.loan),{},{borrower:Ye.borrower,phone:Ye.phone,principal:t,interest:a,totalRepayable:s,startDate:Ye.startDate,dueDate:Ye.dueDate,interestDuration:n});Ze(!0);try{await ae(Ne.loan.id,l),Ee({open:!1,loan:null})}catch(r){console.error("Error updating loan:",r),Te({form:"Failed to update loan. Please try again."})}finally{Ze(!1)}},disabled:He,color:"secondary",children:He?(0,$.jsx)(w.A,{size:20,color:"inherit"}):"Save Changes"})]})]}),(0,$.jsxs)(W.A,{open:qe.open,onClose:()=>Ve({open:!1,loanId:null,payments:[],loading:!1}),maxWidth:"xs",fullWidth:!0,children:[(0,$.jsx)(I.A,{fontSize:"1.1rem",children:"Payment History"}),(0,$.jsx)(M.A,{dividers:!0,children:qe.loading?(0,$.jsx)(s.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100px",children:(0,$.jsx)(w.A,{size:24})}):0===qe.payments.length?(0,$.jsx)(p.A,{variant:"body2",color:"text.secondary",align:"center",children:"No payments recorded for this loan."}):(0,$.jsxs)(o.A,{size:"small",children:[(0,$.jsx)(d.A,{children:(0,$.jsxs)(c.A,{children:[(0,$.jsx)(h.A,{children:"Date"}),(0,$.jsx)(h.A,{align:"right",children:"Amount"})]})}),(0,$.jsx)(x.A,{children:qe.payments.map(e=>(0,$.jsxs)(c.A,{children:[(0,$.jsx)(h.A,{children:K()(e.date).format("YYYY-MM-DD")}),(0,$.jsxs)(h.A,{align:"right",children:["ZMW ",Number(e.amount).toFixed(2)]})]},e.id))})]})}),(0,$.jsx)(L.A,{children:(0,$.jsx)(v.A,{onClick:()=>Ve({open:!1,loanId:null,payments:[],loading:!1}),size:"small",color:"secondary",children:"Close"})})]}),(0,$.jsx)(P.A,{open:Pe,autoHideDuration:4e3,onClose:()=>Fe(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,$.jsx)(R.A,{onClose:()=>Fe(!1),severity:"success",variant:"filled",sx:{width:"100%"},children:"Payment added successfully!"})})]})}}}]);
//# sourceMappingURL=295.4bf9dda3.chunk.js.map