"use strict";(self.webpackChunkloan_management_pwa=self.webpackChunkloan_management_pwa||[]).push([[617],{30617:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ie});var o=a(57528),r=a(89379),l=a(80045),n=a(65043),i=a(53969),s=a(60267),d=a(86995),c=a(46945),p=a(80172),u=a(55895),x=a(24343),m=a(33309),h=a(12843),b=a(57287),f=a(22555),g=a(83290),v=a(22950),A=a(73537),y=a(59267),j=a(67118),C=a(60446),L=a.n(C),S=a(57488),k=a(43962),w=a(9310),I=a(64020),M=a(93201),P=a(40042),D=a(71101),N=a(45297),W=a(86716),O=a(29829),T=a(13106),Y=a(28238),z=a(70579);const R=e=>{const t=Number(e.totalRepayable||0);if(Number(e.repaidAmount||0)>=t&&t>0)return"Paid";const a=L()();return L()(e.dueDate).isBefore(a,"day")?"Overdue":"Active"},K=(e,t)=>{if(0===t)return e>0?"New":null;const a=(e-t)/t*100;return"".concat(a>=0?"+":"").concat(a.toFixed(1),"%")},E=(e,t,a,o)=>{const r=(0,n.useMemo)(()=>{const e={fontSize:o?20:24};return{totalLoans:(0,z.jsx)(N.A,{sx:e}),paidLoans:(0,z.jsx)(M.A,{sx:e}),activeLoans:(0,z.jsx)(P.A,{sx:e}),overdueLoans:t=>(0,z.jsx)(I.A,{badgeContent:t>0?t:null,color:"error",overlap:"circular",anchorOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiBadge-badge":{height:"18px",minWidth:"18px",padding:"0 4px",fontSize:"12px"}},children:(0,z.jsx)(D.A,{sx:e})}),totalDisbursed:(0,z.jsx)(N.A,{sx:e}),investedCapital:(0,z.jsx)(O.A,{sx:e}),availableCapital:(0,z.jsx)(O.A,{sx:e}),totalCollected:(0,z.jsx)(Y.A,{sx:e}),totalOutstanding:(0,z.jsx)(D.A,{sx:e}),expectedProfit:(0,z.jsx)(T.A,{sx:e}),actualProfit:(0,z.jsx)(M.A,{sx:e}),averageLoan:(0,z.jsx)(N.A,{sx:e}),partnerDividends:(0,z.jsx)(W.A,{sx:e})}},[o]),{loansForCalculations:l,defaultCards:s}=(0,n.useMemo)(()=>{const o=e||[],l=o.filter(e=>e.startDate.startsWith(t)),n=L()(t).subtract(1,"month").format("YYYY-MM"),s=o.filter(e=>L()(e.startDate).format("YYYY-MM")===n),d=l.reduce((e,t)=>e+Number(t.principal||0),0),c=l.reduce((e,t)=>e+Number(t.repaidAmount||0),0),p=s.reduce((e,t)=>e+Number(t.principal||0),0),x=s.reduce((e,t)=>e+Number(t.repaidAmount||0),0),m=l.filter(e=>"Paid"===R(e)&&Number(e.repaidAmount||0)>=Number(e.principal||0)+Number(e.interest||0)).reduce((e,t)=>e+Number(t.interest||0),0),h=l.reduce((e,t)=>e+Number(t.interest||0),0),b=h,f=[{name:"Agnes Ilukena",amount:h/2},{name:"Jones Ilukena",amount:h/2}],g=Number(null===a||void 0===a?void 0:a.initialCapital)||6e4,v=g-d+c,A=l.length,y=l.filter(e=>"Paid"===R(e)).length,j=l.filter(e=>"Active"===R(e)).length,C=l.filter(e=>"Overdue"===R(e)).length,S=l.filter(e=>"Active"===R(e)||"Overdue"===R(e)).reduce((e,t)=>e+(Number(t.principal||0)+Number(t.interest||0)-Number(t.repaidAmount||0)),0),k=A>0?Math.round(d/A):0,w=K(d,p),I=K(c,x);return{loansForCalculations:o,defaultCards:[{id:"investedCapital",label:"Invested Capital",value:"K ".concat(g.toLocaleString()),color:"primary",filter:"all",tooltip:"Initial capital invested into loans",progress:null,icon:r.investedCapital},{id:"availableCapital",label:"Available Capital",value:"K ".concat(v.toLocaleString()),color:"success",filter:"all",tooltip:"Capital currently available to issue new loans. Progress against initial capital.",progress:g>0?v/g:0,icon:r.availableCapital},{id:"totalDisbursed",label:"Total Disbursed",value:"K ".concat(d.toLocaleString()),color:"primary",filter:"all",tooltip:"Total principal amount disbursed this month",progress:null,icon:r.totalDisbursed,trend:w},{id:"totalCollected",label:"Total Collected",value:"K ".concat(c.toLocaleString()),color:"info",filter:"paid",tooltip:"Total amount collected from repayments this month",progress:d>0?c/d:null,icon:r.totalCollected,trend:I},{id:"partnerDividends",label:"Partner Dividends",value:"K ".concat(b.toLocaleString()),color:"secondary",filter:"paid",tooltip:(0,z.jsxs)(i.A,{children:[(0,z.jsx)(u.A,{variant:"body2",fontWeight:"bold",children:"Total Dividends (100% of Expected Profit)"}),(0,z.jsxs)(u.A,{variant:"caption",display:"block",mb:1,children:["Expected Profit this month: K ",h.toLocaleString()]}),f.map(e=>(0,z.jsx)(u.A,{variant:"caption",display:"block",children:"".concat(e.name,": K ").concat(e.amount.toLocaleString())},e.name))]}),progress:null,icon:r.partnerDividends},{id:"totalLoans",label:"Total Loans",value:A,color:"primary",filter:"all",tooltip:"Total number of loans issued this month",progress:null,icon:r.totalLoans},{id:"paidLoans",label:"Paid Loans",value:y,color:"success",filter:"paid",tooltip:"Loans fully paid back this month",progress:A?y/A:0,icon:r.paidLoans},{id:"activeLoans",label:"Active Loans",value:j,color:"info",filter:"active",tooltip:"Loans currently active and being repaid",progress:A?j/A:0,icon:r.activeLoans},{id:"overdueLoans",label:"Overdue Loans",value:C,color:"error",filter:"overdue",tooltip:"Loans overdue for repayment",progress:A?C/A:0,icon:r.overdueLoans(C),pulse:C>0},{id:"totalOutstanding",label:"Total Outstanding",value:"K ".concat(S.toLocaleString()),color:"warning",filter:"active",tooltip:"Total outstanding repayments still due",progress:null,icon:r.totalOutstanding},{id:"expectedProfit",label:"Interest Expected",value:"K ".concat(h.toLocaleString()),color:"secondary",filter:"all",tooltip:"Total expected profit from interest",progress:null,icon:r.expectedProfit},{id:"actualProfit",label:"Actual Interest",value:"K ".concat(m.toLocaleString()),color:"success",filter:"paid",tooltip:"Profit earned from fully repaid loans",progress:h>0?m/h:null,icon:r.actualProfit},{id:"averageLoan",label:"Average Loan",value:"K ".concat(k.toLocaleString()),color:"primary",filter:"all",tooltip:"Average loan amount issued this month",progress:null,icon:r.averageLoan}]}},[e,t,a,r]);return{loansForCalculations:l,defaultCards:s}};var H=a(53089),B=a(26529),F=a(91244),J=a(26020),_=a(46446),U=a(50311),G=a(45606),Z=a(7002);const q={hidden:{opacity:0,y:20},visible:e=>({opacity:1,y:0,transition:{delay:.1*e,duration:.4,ease:"easeOut"}})},Q=e=>{var t,a,o;let{card:l,index:n,isMobile:d,handleCardClick:c,provided:p,snapshot:x}=e;const m=(0,s.A)();return(0,z.jsx)(H.A,(0,r.A)((0,r.A)((0,r.A)({item:!0,xs:d?4:6,sm:6,md:4,lg:3,ref:p.innerRef},p.draggableProps),!d&&p.dragHandleProps),{},{style:(0,r.A)((0,r.A)({},p.draggableProps.style),{},{userSelect:x.isDragging?"none":"auto"}),children:(0,z.jsx)(B.A,{title:l.tooltip,arrow:!0,placement:"top",children:(0,z.jsx)(_.P.div,{variants:q,initial:"hidden",animate:"visible",custom:n,whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>c(l.filter),style:{height:"100%"},children:(0,z.jsxs)(F.A,{sx:(0,r.A)((0,r.A)({p:d?1.5:2,borderRadius:3,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",backgroundColor:m.palette.background.paper,boxShadow:m.shadows[1],border:"1px solid ".concat(m.palette.divider),transition:"box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out","&:hover":{boxShadow:m.shadows[4],cursor:"pointer",borderColor:(null===(t=m.palette[l.color])||void 0===t?void 0:t.main)||m.palette.primary.main}},l.pulse&&{animation:"pulse 1.5s infinite"}),{},{position:"relative"}),children:[d&&(0,z.jsx)(i.A,(0,r.A)((0,r.A)({},p.dragHandleProps),{},{sx:{position:"absolute",top:4,right:4,cursor:"grab",color:m.palette.grey[500],zIndex:1},children:(0,z.jsx)(Z.A,{fontSize:"small"})})),(0,z.jsxs)(i.A,{display:"flex",justifyContent:"center",alignItems:"center",mb:.5,gap:.5,children:[(0,z.jsx)(i.A,{sx:{color:(null===(a=m.palette[l.color])||void 0===a?void 0:a.main)||m.palette.text.primary},children:"function"===typeof l.icon?l.icon(l.value):l.icon}),(0,z.jsx)(u.A,{variant:"caption",sx:{color:m.palette.text.secondary,fontWeight:500,fontSize:d?"0.6rem":"0.75rem"},children:l.label})]}),(0,z.jsx)(i.A,{sx:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,z.jsx)(u.A,{variant:"h6",sx:{fontWeight:800,lineHeight:1.1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:d?"1.2rem":"1.8rem"},children:l.value})}),null!==l.progress&&(0,z.jsx)(J.A,{variant:"determinate",value:100*l.progress,sx:{height:5,borderRadius:2,backgroundColor:m.palette.grey[300],"& .MuiLinearProgress-bar":{backgroundColor:(null===(o=m.palette[l.color])||void 0===o?void 0:o.main)||m.palette.primary.main},width:"80%",mt:.5,mb:.5}}),l.trend&&(0,z.jsxs)(i.A,{display:"flex",alignItems:"center",gap:.5,mt:.5,children:[l.trend.startsWith("+")?(0,z.jsx)(U.A,{fontSize:"small",sx:{color:m.palette.success.main}}):(0,z.jsx)(G.A,{fontSize:"small",sx:{color:m.palette.error.main}}),(0,z.jsxs)(u.A,{variant:"caption",sx:{color:l.trend.startsWith("+")?m.palette.success.main:m.palette.error.main,fontWeight:600},children:[l.trend," vs. last month"]})]})]})})})}))},V=e=>{let{cards:t,droppableId:a,isMobile:o,handleCardClick:l}=e;return(0,z.jsx)(k.gL,{droppableId:a,direction:"horizontal",children:e=>(0,z.jsxs)(H.A,(0,r.A)((0,r.A)({container:!0,spacing:o?1.5:2},e.droppableProps),{},{ref:e.innerRef,children:[t.map((e,t)=>(0,z.jsx)(k.sx,{draggableId:e.id,index:t,children:(a,r)=>(0,z.jsx)(Q,{card:e,index:t,isMobile:o,handleCardClick:l,provided:a,snapshot:r})},e.id)),e.placeholder]}))})};var X;const $=["children","value","index"],ee=(0,n.lazy)(()=>Promise.all([a.e(371),a.e(808)]).then(a.bind(a,55808))),te="dashboardCardOrder",ae=["investedCapital","availableCapital","totalDisbursed","totalCollected","partnerDividends","totalLoans","paidLoans","activeLoans","overdueLoans","totalOutstanding","expectedProfit","actualProfit"],oe=["investedCapital","availableCapital","totalDisbursed","totalCollected","partnerDividends"];function re(e){const{children:t,value:a,index:o}=e,n=(0,l.A)(e,$);return(0,z.jsx)("div",(0,r.A)((0,r.A)({role:"tabpanel",hidden:a!==o,id:"simple-tabpanel-".concat(o),"aria-labelledby":"simple-tab-".concat(o)},n),{},{children:a===o&&(0,z.jsx)(i.A,{sx:{p:{xs:2,md:3}},children:t})}))}function le(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}const ne=(0,g.i7)(X||(X=(0,o.A)(["\n  0% {\n    opacity: 0;\n    transform: scale(0.9) translateY(10px);\n  }\n  75% {\n    opacity: 1;\n    transform: scale(1.05) translateY(-5px);\n  }\n  100% {\n    opacity: 1;\n    transform: scale(1) translateY(0);\n  }\n"])));function ie(){const e=(0,A.Zp)(),t=(0,s.A)(),a=(0,d.A)(t.breakpoints.down("sm")),{loans:o,settings:l,loading:g}=(0,y.j)(),{currentUser:C}=(0,j.A)(),[I,M]=(0,n.useState)(L()().format("YYYY-MM")),[P,D]=(0,n.useState)([]),[N,W]=(0,n.useState)(0),[O,T]=(0,n.useState)(!0),{loansForCalculations:Y,defaultCards:R}=E(o,I,l,a);(0,n.useEffect)(()=>{if(C){const e=setTimeout(()=>{T(!1)},1e4);return()=>clearTimeout(e)}},[C]),(0,n.useEffect)(()=>{if(o){const t=localStorage.getItem(te);try{const e=(t?JSON.parse(t):[]).filter(e=>ae.includes(e)),a=[...new Set([...e,...ae])];D(a)}catch(e){console.error("Error parsing saved card order from localStorage:",e),D(ae)}}},[o]);const K=(0,n.useMemo)(()=>P.length?P.map(e=>R.find(t=>t.id===e)).filter(Boolean):R,[P,R]),H=K.filter(e=>oe.includes(e.id)),B=K.filter(e=>!oe.includes(e.id)),F=(0,n.useCallback)(e=>{const{source:t,destination:a}=e;if(!a||t.droppableId!==a.droppableId)return void S.oR.error("Cards can only be reordered within their own section.");let o,r;if("executive-summary-droppable"===t.droppableId){o=Array.from(H);const[e]=o.splice(t.index,1);o.splice(a.index,0,e);const l=B.map(e=>e.id);r=[...o.map(e=>e.id),...l]}else{o=Array.from(B);const[e]=o.splice(t.index,1);o.splice(a.index,0,e);r=[...H.map(e=>e.id),...o.map(e=>e.id)]}D(r),localStorage.setItem(te,JSON.stringify(r)),S.oR.success("Dashboard layout saved!")},[H,B]),J=t=>{const a=new URLSearchParams;"all"!==t&&a.set("filter",t),I&&a.set("month",I),e("/loans?".concat(a.toString()))};if(g)return(0,z.jsxs)(c.A,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:t.palette.background.default},open:g,children:[(0,z.jsx)(p.A,{color:"primary"}),(0,z.jsx)(u.A,{variant:"h6",sx:{mt:2,color:t.palette.text.primary},children:"Loading dashboard..."})]});const _=(null===C||void 0===C?void 0:C.displayName)||(null===C||void 0===C?void 0:C.email);return(0,z.jsxs)(i.A,{sx:{minHeight:"100vh",background:t.palette.background.default,p:{xs:2,md:3},pb:a?"calc(".concat(w.E,"px + ").concat(t.spacing(2),")"):3},children:[_&&O&&(0,z.jsx)(i.A,{sx:{animation:"".concat(ne," 0.5s ease-out forwards"),mb:1},children:(0,z.jsxs)(u.A,{variant:"h5",sx:{color:t.palette.text.secondary,fontWeight:600},children:["Welcome back, ",_,"!"]})}),(0,z.jsx)(u.A,{variant:"h5",gutterBottom:!0,sx:{fontWeight:600,mb:.5,fontSize:{xs:"1.5rem",md:"2rem"}},children:"Dashboard"}),(0,z.jsx)(i.A,{mb:a?1.5:2,maxWidth:a?"100%":200,children:(0,z.jsx)(x.A,{label:"Select Month",type:"month",value:I,onChange:e=>M(e.target.value),size:"small",fullWidth:!0,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:t.palette.background.paper,"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:t.palette.secondary.main}},"& .MuiInputBase-input":{padding:a?"10px 14px":"12px 16px"},"& .MuiInputLabel-root":{transform:a?"translate(14px, 10px) scale(0.75)":"translate(14px, 12px) scale(0.75)"},"& .MuiInputLabel-root.Mui-focused":{color:t.palette.secondary.main},"& .MuiInputLabel-shrink":{transform:"translate(14px, -9px) scale(0.75)"}}})}),(0,z.jsxs)(i.A,{sx:{width:"100%",boxShadow:t.shadows[3],borderRadius:4},children:[(0,z.jsx)(i.A,{sx:{backgroundColor:t.palette.background.paper,borderRadius:4,display:"flex",alignItems:"center",p:{xs:.5,sm:1},flexWrap:"wrap"},children:(0,z.jsxs)(m.A,{value:N,onChange:(e,t)=>{W(t)},"aria-label":"dashboard sections tabs",variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{"& .MuiTabs-indicator":{display:"none"},"& .MuiTabs-flexContainer":{gap:{xs:0,sm:1}}},children:[(0,z.jsx)(h.A,(0,r.A)((0,r.A)({label:"Summary"},le(0)),{},{sx:{color:0===N?t.palette.text.primary:t.palette.text.secondary,fontWeight:0===N?600:500,borderRadius:999,backgroundColor:0===N?t.palette.action.selected:"transparent",boxShadow:0===N?t.shadows[1]:"none",textTransform:"none",transition:"all 0.3s ease",minHeight:48,minWidth:"auto",px:{xs:1.5,sm:2},"&:hover":{backgroundColor:0===N?t.palette.action.selected:t.palette.action.hover,color:t.palette.text.primary}}})),(0,z.jsx)(h.A,(0,r.A)((0,r.A)({label:"Metrics"},le(1)),{},{sx:{color:1===N?t.palette.text.primary:t.palette.text.secondary,fontWeight:1===N?600:500,borderRadius:999,backgroundColor:1===N?t.palette.action.selected:"transparent",boxShadow:1===N?t.shadows[1]:"none",textTransform:"none",transition:"all 0.3s ease",minHeight:48,minWidth:"auto",px:{xs:1.5,sm:2},"&:hover":{backgroundColor:1===N?t.palette.action.selected:t.palette.action.hover,color:t.palette.text.primary}}})),(0,z.jsx)(h.A,(0,r.A)((0,r.A)({label:"Charts"},le(2)),{},{sx:{color:2===N?t.palette.text.primary:t.palette.text.secondary,fontWeight:2===N?600:500,borderRadius:999,backgroundColor:2===N?t.palette.action.selected:"transparent",boxShadow:2===N?t.shadows[1]:"none",textTransform:"none",transition:"all 0.3s ease",minHeight:48,minWidth:"auto",px:{xs:1.5,sm:2},"&:hover":{backgroundColor:2===N?t.palette.action.selected:t.palette.action.hover,color:t.palette.text.primary}}}))]})}),(0,z.jsxs)(k.JY,{onDragEnd:F,children:[(0,z.jsx)(re,{value:N,index:0,children:(0,z.jsx)(V,{cards:H,droppableId:"executive-summary-droppable",isMobile:a,handleCardClick:J})}),(0,z.jsx)(re,{value:N,index:1,children:(0,z.jsx)(V,{cards:B,droppableId:"metrics-droppable",isMobile:a,handleCardClick:J})})]}),(0,z.jsx)(re,{value:N,index:2,children:(0,z.jsx)(n.Suspense,{fallback:(0,z.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,z.jsx)(p.A,{color:"primary"})}),children:Y.length>0?(0,z.jsx)(ee,{loans:Y,selectedMonth:I}):(0,z.jsx)(u.A,{variant:"body2",color:"text.secondary",children:"No loan data available for charts."})})})]}),(0,z.jsx)(b.A,{in:!0,style:{position:"fixed",bottom:a?"calc(".concat(w.E,"px + 16px)"):16,right:16},timeout:500,unmountOnExit:!0,children:(0,z.jsx)(f.A,{color:"secondary","aria-label":"add loan",onClick:()=>e("/add-loan"),children:(0,z.jsx)(v.A,{})})})]})}}}]);
//# sourceMappingURL=617.b2331191.chunk.js.map