"use strict";(self.webpackChunkloan_management_pwa=self.webpackChunkloan_management_pwa||[]).push([[223],{77223:(e,t,n)=>{n.r(t),n.d(t,{default:()=>W});var r=n(89379),i=n(65043),a=n(53969),o=n(55895),l=n(70298),s=n(24343),c=n(10256),d=n(79067),u=n(67203),p=n(47471),h=n(95315),x=n(78403),g=n(24244),m=n(64020),A=n(17873),v=n(66185),y=n(26529),f=n(40405),j=n(83759),b=n(80172),w=n(59267),C=n(23546),L=n(46446),S=n(60267),_=n(86995),M=n(79864),D=n(24653),k=n(70579);const E={hidden:{opacity:0,y:10},visible:{opacity:1,y:0},exit:{opacity:0,y:-10}},T={loan_creation:"Loan Created",edit:"Edited",payment:"Payment Made",login:"Login",delete:"Loan Deleted",settings_update:"Settings Updated"},z={loan_creation:"primary",edit:"default",payment:"success",login:"info",delete:"error",settings_update:"secondary"};function W(){const{activityLogs:e}=(0,w.j)(),t=(0,S.A)(),n=(0,_.A)(t.breakpoints.down("sm")),[W,I]=(0,i.useState)(1),[U,H]=(0,i.useState)([]),O=(0,i.useRef)(null),[N,P]=(0,i.useState)(""),[B,R]=(0,i.useState)("all"),F={"& .MuiOutlinedInput-root":{"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:t.palette.secondary.main}},"& .MuiInputLabel-root.Mui-focused":{color:t.palette.secondary.main},"& .MuiSvgIcon-root":{"&.Mui-focused":{color:t.palette.secondary.main}}};function Y(e,n){if(!n)return e;const r=new RegExp("(".concat(n,")"),"gi");return e.split(r).map((e,n)=>r.test(e)?(0,k.jsx)(a.A,{component:"span",sx:{bgcolor:t.palette.secondary.light,fontWeight:"bold"},children:e},n):e)}function q(e){if(!e)return"?";const t=e.split(" ");return 1===t.length?t[0].substring(0,2).toUpperCase():(t[0][0]+t[1][0]).toUpperCase()}const G=(0,i.useMemo)(()=>e.filter(e=>{var t;return("all"===B||e.type===B)&&!!(!N||e.description.toLowerCase().includes(N.toLowerCase())||null!==(t=e.user)&&void 0!==t&&t.toLowerCase().includes(N.toLowerCase()))}).sort((e,t)=>{const n=e.date||e.createdAt||0,r=t.date||t.createdAt||0;return new Date(r)-new Date(n)}),[e,B,N]);return(0,i.useEffect)(()=>{H(G.slice(0,20*W))},[G,W]),(0,i.useEffect)(()=>{if(!n)return;const e=()=>{if(!O.current)return;const{scrollTop:e,scrollHeight:t,clientHeight:n}=O.current;e+n>=t-100&&U.length<G.length&&I(e=>e+1)},t=O.current;return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[U.length,G.length,n]),(0,i.useEffect)(()=>{I(1)},[B,N]),(0,k.jsxs)(a.A,{p:3,maxWidth:700,mx:"auto",height:n?"80vh":"auto",sx:{overflowY:n?"auto":"visible"},ref:O,children:[(0,k.jsx)(o.A,{variant:"h4",gutterBottom:!0,children:"Activity Log"}),(0,k.jsxs)(l.A,{direction:{xs:"column",sm:"row"},spacing:2,mb:3,children:[(0,k.jsx)(s.A,{sx:F,label:"Search",value:N,onChange:e=>P(e.target.value),fullWidth:!0,size:"small",variant:"outlined"}),(0,k.jsxs)(c.A,{sx:(0,r.A)({minWidth:160},F),size:"small",children:[(0,k.jsx)(d.A,{children:"Type"}),(0,k.jsxs)(u.A,{value:B,label:"Type",onChange:e=>R(e.target.value),children:[(0,k.jsx)(p.A,{value:"all",children:"All"}),(0,k.jsx)(p.A,{value:"loan_creation",children:"Loan Creation"}),(0,k.jsx)(p.A,{value:"edit",children:"Edit"}),(0,k.jsx)(p.A,{value:"payment",children:"Payment"}),(0,k.jsx)(p.A,{value:"login",children:"Login"}),(0,k.jsx)(p.A,{value:"delete",children:"Delete"}),(0,k.jsx)(p.A,{value:"settings_update",children:"Settings Update"})]})]})]}),(0,k.jsx)(h.A,{children:(0,k.jsx)(C.N,{children:U.map(e=>{var n,r;const i=e.user||"System",l=null!==(n=T[e.type])&&void 0!==n?n:e.type?e.type.replace(/_/g," "):"Unknown Action",s=e.date||e.createdAt;let c="No valid date",d="";if(s)try{const e="string"===typeof s?(0,D.H)(s):s.toDate?s.toDate():s;d=(0,M.m)(e,{addSuffix:!0}),c=e.toLocaleString()}catch(p){}const u=s&&(()=>{try{const e="string"===typeof s?(0,D.H)(s):s.toDate?s.toDate():s;return new Date-e<864e5}catch(e){return!1}})();return(0,k.jsx)(L.P.div,{initial:"hidden",animate:"visible",exit:"exit",variants:E,children:(0,k.jsxs)(x.A,{divider:!0,sx:{py:1.5,"&:hover":{bgcolor:t.palette.action.hover},cursor:"default"},children:[(0,k.jsx)(g.A,{children:(0,k.jsx)(m.A,{color:"error",variant:"dot",overlap:"circular",invisible:!u,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,k.jsx)(A.A,{sx:{bgcolor:t.palette.primary.main},children:q(i)})})}),(0,k.jsx)(v.A,{primary:(0,k.jsxs)(a.A,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",children:[(0,k.jsx)(o.A,{variant:"subtitle1",component:"span",fontWeight:"bold",children:Y(i,N)}),(0,k.jsx)(y.A,{title:l,placement:"top",TransitionComponent:f.A,arrow:!0,children:(0,k.jsx)(j.A,{label:l,size:"small",color:z[e.type]||"default",sx:{textTransform:"capitalize",cursor:"help"}})})]}),secondary:(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(y.A,{title:c,arrow:!0,placement:"top",TransitionComponent:f.A,children:(0,k.jsx)(o.A,{component:"span",variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5,fontStyle:"italic"},children:d})}),(0,k.jsx)(o.A,{component:"span",variant:"body2",children:Y(null!==(r=e.description)&&void 0!==r?r:"",N)})]})})]})},e.id)})})}),!n&&G.length>U.length&&(0,k.jsx)(a.A,{textAlign:"center",mt:2,children:(0,k.jsx)(o.A,{variant:"button",onClick:()=>I(e=>e+1),sx:{cursor:"pointer",color:t.palette.secondary.main,userSelect:"none"},children:"Load More"})}),n&&U.length<G.length&&(0,k.jsx)(a.A,{textAlign:"center",mt:2,children:(0,k.jsx)(b.A,{size:24})}),0===U.length&&(0,k.jsxs)(a.A,{mt:6,textAlign:"center",color:t.palette.text.secondary,sx:{userSelect:"none"},children:[(0,k.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:"No activity logs found"}),(0,k.jsx)(o.A,{variant:"body2",children:"Try adjusting your search or filters."})]})]})}}}]);
//# sourceMappingURL=223.936c3485.chunk.js.map