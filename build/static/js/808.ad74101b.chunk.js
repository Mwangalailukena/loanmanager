"use strict";(self.webpackChunkloan_management_pwa=self.webpackChunkloan_management_pwa||[]).push([[808],{55808:(e,t,a)=>{a.r(t),a.d(t,{default:()=>P});var i=a(89379),n=a(65043),r=a(84339),o=a(53969),s=a(80172),l=a(55895),d=a(42579),c=a(53089),h=a(94799),m=a(26529),u=a(38517),x=a(81911),f=a(78776),p=a(60267),g=a(86995),b=a(27421),y=a(98286),A=a(31036),j=a(14037),v=a(60446),k=a.n(v),S=a(51525),M=a.n(S),Y=a(58315),C=a(67079),L=a(12690),D=a(70579);k().extend(M());const O=n.forwardRef(function(e,t){return(0,D.jsx)(r.A,(0,i.A)({direction:"up",ref:t},e))}),w=e=>{if(e.repaidAmount>=e.principal)return"Paid";const t=k()();if(!e.repaymentSchedule||0===e.repaymentSchedule.length)return"Active";const a=[...e.repaymentSchedule].sort((e,t)=>k()(e.date).unix()-k()(t.date).unix());for(const i of a){if(k()(i.date).isBefore(t,"day")&&i.repaidAmount<i.amount)return"Overdue"}return"Active"},z=(e,t,a,i,n,r)=>{const o=((e,t)=>({axis:{ticks:{text:{fill:e.palette.text.secondary,fontSize:t?8:10,fontFamily:e.typography.fontFamily}},legend:{text:{fill:e.palette.text.primary,fontSize:t?10:14,fontWeight:500,fontFamily:e.typography.fontFamily}}},grid:{line:{stroke:e.palette.divider,strokeDasharray:"2 2"}},tooltip:{container:{background:e.palette.background.paper,color:e.palette.text.primary,fontSize:12,borderRadius:8,boxShadow:e.shadows[3],padding:"8px 12px"}},legends:{text:{fill:e.palette.text.primary,fontSize:t?10:12,fontFamily:e.typography.fontFamily}}}))(i,t),s=((e,t)=>t?{top:40,right:120,bottom:80,left:80}:e?{top:20,right:10,bottom:50,left:35}:{top:20,right:60,bottom:60,left:60})(t,a);switch(e){case"line":return{margin:s,theme:o,colors:r,xScale:{type:"time",format:"%Y-%m-%d",useUTC:!1,precision:"month"},xFormat:"time:%Y-%m-%d",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-,.0f",axisBottom:{format:"%b %y",tickValues:"every 3 months",legend:"Date",legendOffset:a?50:t?40:35,legendPosition:"middle",tickRotation:t&&!a?45:0},axisLeft:{legend:"ZMW",legendOffset:a?-70:t?-35:-50,legendPosition:"middle"},pointSize:a?8:4,pointBorderWidth:a?2:1,pointBorderColor:{from:"serieColor"},legends:[{anchor:"bottom-right",direction:"column",justify:!1,translateX:a?100:80,translateY:0,itemsSpacing:0,itemDirection:"left-to-right",itemWidth:a?100:70,itemHeight:a?20:16,symbolSize:a?12:8,symbolShape:"circle",effects:[{on:"hover",style:{itemBackground:"rgba(0, 0, 0, .03)",itemOpacity:1}}]}]};case"pie":return{margin:s,theme:o,innerRadius:.5,padAngle:.7,cornerRadius:3,activeOuterRadiusOffset:8,borderWidth:1,borderColor:{from:"color",modifiers:[["darker",.2]]},arcLinkLabelsSkipAngle:10,arcLinkLabelsTextColor:i.palette.text.primary,arcLinkLabelsThickness:2,arcLinkLabelsColor:{from:"color"},arcLabelsSkipAngle:10,arcLabelsTextColor:{from:"color",modifiers:[["darker",2]]},legends:t?[]:[{anchor:"bottom",direction:"row",justify:!1,translateX:0,translateY:a?60:30,itemsSpacing:t?5:10,itemWidth:a?100:70,itemHeight:a?20:14,itemTextColor:i.palette.text.primary,symbolSize:a?20:12,symbolShape:"circle"}]};case"bar":return{margin:s,theme:o,padding:.3,valueScale:{type:"linear"},indexScale:{type:"band",round:!0},colors:r[0],borderColor:{from:"color",modifiers:[["darker",1.6]]},axisTop:null,axisRight:null,axisBottom:{tickSize:5,tickPadding:5,tickRotation:t&&!a?45:0,legend:"Amount Range",legendPosition:"middle",legendOffset:a?50:t?45:35},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,legend:"Loans",legendPosition:"middle",legendOffset:a?-70:t?-35:-50},labelSkipWidth:12,labelSkipHeight:12,labelTextColor:{from:"color",modifiers:[["darker",1.6]]},legends:[]};case"stackedBar":return{margin:s,theme:o,padding:.3,groupMode:"stacked",valueScale:{type:"linear"},indexScale:{type:"band",round:!0},borderColor:{from:"color",modifiers:[["darker",1.6]]},axisTop:null,axisRight:null,axisBottom:{tickSize:5,tickPadding:5,tickRotation:t&&!a?45:0,legend:"Month",legendPosition:"middle",legendOffset:a?50:t?45:35,format:e=>k()(e).format("MMM YY")},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,legend:"Loans",legendPosition:"middle",legendOffset:a?-70:t?-35:-50},labelSkipWidth:12,labelSkipHeight:12,labelTextColor:{from:"color",modifiers:[["darker",1.6]]},legends:[{dataFrom:"keys",anchor:"bottom-right",direction:"column",justify:!1,translateX:a?100:80,translateY:0,itemsSpacing:2,itemWidth:a?90:80,itemHeight:a?20:18,itemDirection:"left-to-right",itemOpacity:.85,symbolSize:a?20:16,data:["Active","Paid","Overdue"].map(e=>({id:e,label:e,color:n[e]})),effects:[{on:"hover",style:{itemOpacity:1}}]}]};default:return{}}},P=e=>{let{loans:t,selectedMonth:a}=e;const r=(0,p.A)(),v=(0,g.A)(r.breakpoints.down("sm")),[S,M]=(0,n.useState)(a),P=v?250:300,B="calc(".concat(P,"px - ").concat(v?55:60,"px)"),[R,W]=(0,n.useState)(!1),[T,E]=(0,n.useState)(null),F=(0,n.useMemo)(()=>({Paid:r.palette.success.main,Active:r.palette.primary.main,Overdue:r.palette.error.main}),[r]),N=(0,n.useMemo)(()=>[r.palette.primary.main,r.palette.secondary.main,r.palette.success.main,r.palette.info.main,r.palette.warning.main,r.palette.error.main],[r]),I=function(e,t,a){E({type:e,data:t,title:a,keys:arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],indexBy:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null}),W(!0)},H=()=>{W(!1),E(null)},_=(0,n.useMemo)(()=>t?t.map(e=>(0,i.A)((0,i.A)({},e),{},{calculatedStatus:w(e)})):[],[t]),X=(0,n.useMemo)(()=>{if(!_||0===_.length)return null;const e=_.map(e=>k()(e.startDate).startOf("month")).sort((e,t)=>t.diff(e));return e.length>0?e[0].format("YYYY-MM"):null},[_]);(0,n.useEffect)(()=>{const e=k()(a).format("YYYY-MM"),t=_.some(t=>k()(t.startDate).format("YYYY-MM")===e);M(t?e:X||e)},[a,_,X]);const G=(0,n.useMemo)(()=>_&&0!==_.length?_.filter(e=>k()(e.startDate).format("YYYY-MM")===S):[],[_,S]),U=(0,n.useMemo)(()=>{if(!_||0===_.length)return[];const e=new Map;_.forEach(t=>{const a=k()(t.startDate).format("YYYY-MM-DD");e.has(a)||e.set(a,{disbursed:0,collected:0});const i=e.get(a);i.disbursed+=Number(t.principal||0),i.collected+=Number(t.repaidAmount||0)});const t=Array.from(e.entries()).map(e=>{let[t,a]=e;return(0,i.A)({x:t},a)}).sort((e,t)=>k()(e.x).diff(k()(t.x)));return[{id:"Disbursed",data:t.map(e=>({x:e.x,y:e.disbursed}))},{id:"Collected",data:t.map(e=>({x:e.x,y:e.collected}))}]},[_]),V=(0,n.useMemo)(()=>U.some(e=>e.data.length>0),[U]),Z=(0,n.useMemo)(()=>{const e={Active:0,Paid:0,Overdue:0};return G&&G.length>0&&G.forEach(t=>{const a=t.calculatedStatus;Object.keys(e).includes(a)&&(e[a]+=1)}),Object.keys(e).map(t=>({id:t,label:t,value:e[t]}))},[G]),q=(0,n.useMemo)(()=>{if(!G||0===G.length)return[];const e={"0-500":0,"501-1000":0,"1001-2000":0,"2001-5000":0,"5000+":0};return G.forEach(t=>{const a=Number(t.principal||0);a<=500?e["0-500"]++:a<=1e3?e["501-1000"]++:a<=2e3?e["1001-2000"]++:a<=5e3?e["2001-5000"]++:e["5000+"]++}),Object.keys(e).map(t=>({range:t,count:e[t]}))},[G]),J=(0,n.useMemo)(()=>{if(!_||0===_.length)return[];const e=new Map;return _.forEach(t=>{const a=k()(t.startDate).format("YYYY-MM");e.has(a)||e.set(a,{month:a,Active:0,Paid:0,Overdue:0});const i=e.get(a),n=t.calculatedStatus;["Active","Paid","Overdue"].includes(n)&&i[n]++}),Array.from(e.values()).sort((e,t)=>k()(e.month).diff(k()(t.month)))},[_]);if(void 0===t||null===t)return(0,D.jsxs)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:P,p:2},children:[(0,D.jsx)(s.A,{}),(0,D.jsx)(l.A,{variant:"body1",sx:{ml:2},children:"Loading loan data..."})]});if(0===t.length)return(0,D.jsx)(o.A,{sx:{p:2,textAlign:"center",color:r.palette.text.secondary},children:(0,D.jsx)(l.A,{variant:"body1",children:"No loan data available."})});const K=e=>{let{height:t,message:a}=e;return(0,D.jsx)(o.A,{sx:{height:t,display:"flex",alignItems:"center",justifyContent:"center",color:r.palette.text.secondary,p:2},children:(0,D.jsx)(l.A,{variant:"body2",align:"center",children:a})})};return(0,D.jsxs)(o.A,{children:[(0,D.jsxs)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:2,mb:3,pt:1},children:[(0,D.jsx)(d.A,{onClick:()=>{const e=k()(S).subtract(1,"month").format("YYYY-MM");M(e)},"aria-label":"Previous month",children:(0,D.jsx)(Y.A,{})}),(0,D.jsxs)(l.A,{variant:"h5",component:"h2",sx:{fontWeight:600},children:[k()(S).format("MMMM YYYY")," Data"]}),(0,D.jsx)(d.A,{onClick:()=>{const e=k()(S).add(1,"month").format("YYYY-MM");M(e)},"aria-label":"Next month",children:(0,D.jsx)(C.A,{})})]}),(0,D.jsxs)(c.A,{container:!0,spacing:v?1.5:2,children:[(0,D.jsx)(c.A,{item:!0,xs:12,md:6,children:(0,D.jsxs)(h.A,{elevation:1,sx:{p:v?1.5:2,borderRadius:2,height:P,cursor:"pointer",transition:"box-shadow 0.3s","&:hover":{boxShadow:r.shadows[4]}},onClick:()=>I("line",U,"Monthly Disbursements & Collections"),children:[(0,D.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:v?1:2},children:[(0,D.jsx)(l.A,{variant:"h6",sx:{fontWeight:600,fontSize:v?"1rem":"1.15rem"},children:"Monthly Disbursements & Collections"}),(0,D.jsx)(m.A,{title:"Shows the total amount of loans disbursed versus the total amount collected each month across all available data.",children:(0,D.jsx)(d.A,{size:"small",sx:{ml:1},children:(0,D.jsx)(L.A,{fontSize:"small"})})})]}),V?(0,D.jsx)(o.A,{sx:{height:B},children:(0,D.jsx)(j.bt,(0,i.A)({data:U,ariaLabel:"Monthly Disbursements and Collections Line Chart"},z("line",v,!1,r,null,N)))}):(0,D.jsx)(K,{height:B,message:"No data available for this period."})]})}),(0,D.jsx)(c.A,{item:!0,xs:12,md:6,children:(0,D.jsxs)(h.A,{elevation:1,sx:{p:v?1.5:2,borderRadius:2,height:P,cursor:"pointer",transition:"box-shadow 0.3s","&:hover":{boxShadow:r.shadows[4]}},onClick:()=>I("pie",Z,"Loan Status Distribution"),children:[(0,D.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:v?1:2},children:[(0,D.jsx)(l.A,{variant:"h6",sx:{fontWeight:600,fontSize:v?"1rem":"1.15rem"},children:"Loan Status Distribution"}),(0,D.jsx)(m.A,{title:"Shows the distribution of loan statuses for ".concat(k()(S).format("MMMM YYYY"),"."),children:(0,D.jsx)(d.A,{size:"small",sx:{ml:1},children:(0,D.jsx)(L.A,{fontSize:"small"})})})]}),Z.length>0&&Z.some(e=>e.value>0)?(0,D.jsx)(o.A,{sx:{height:B},children:(0,D.jsx)(y.fO,(0,i.A)({data:Z,colors:e=>{let{id:t}=e;return F[t]},ariaLabel:"Loan Status Distribution Pie Chart"},z("pie",v,!1,r,null,null)))}):(0,D.jsx)(K,{height:B,message:"No loan status data for this period."})]})}),(0,D.jsx)(c.A,{item:!0,xs:12,md:6,children:(0,D.jsxs)(h.A,{elevation:1,sx:{p:v?1.5:2,borderRadius:2,height:P,cursor:"pointer",transition:"box-shadow 0.3s","&:hover":{boxShadow:r.shadows[4]}},onClick:()=>I("bar",q,"Loan Amount Distribution",["count"],"range"),children:[(0,D.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:v?1:2},children:[(0,D.jsx)(l.A,{variant:"h6",sx:{fontWeight:600,fontSize:v?"1rem":"1.15rem"},children:"Loan Amount Distribution"}),(0,D.jsx)(m.A,{title:"Displays the number of loans within different principal amount ranges for ".concat(k()(S).format("MMMM YYYY"),"."),children:(0,D.jsx)(d.A,{size:"small",sx:{ml:1},children:(0,D.jsx)(L.A,{fontSize:"small"})})})]}),q.length>0&&q.some(e=>e.count>0)?(0,D.jsx)(o.A,{sx:{height:B},children:(0,D.jsx)(A.ED,(0,i.A)({data:q,keys:["count"],indexBy:"range",ariaLabel:"Loan Amount Distribution Bar Chart"},z("bar",v,!1,r,null,N)))}):(0,D.jsx)(K,{height:B,message:"No loan amount data for this period."})]})}),(0,D.jsx)(c.A,{item:!0,xs:12,md:6,children:(0,D.jsxs)(h.A,{elevation:1,sx:{p:v?1.5:2,borderRadius:2,height:P,cursor:"pointer",transition:"box-shadow 0.3s","&:hover":{boxShadow:r.shadows[4]}},onClick:()=>I("stackedBar",J,"Loan Status Count Over Time",["Active","Paid","Overdue"],"month"),children:[(0,D.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:v?1:2},children:[(0,D.jsx)(l.A,{variant:"h6",sx:{fontWeight:600,fontSize:v?"1rem":"1.15rem"},children:"Loan Status Count Over Time"}),(0,D.jsx)(m.A,{title:"Tracks the number of loans in different statuses (Active, Paid, Overdue) for each month across all available data.",children:(0,D.jsx)(d.A,{size:"small",sx:{ml:1},children:(0,D.jsx)(L.A,{fontSize:"small"})})})]}),J.length>0&&J.some(e=>e.Active>0||e.Paid>0||e.Overdue>0)?(0,D.jsx)(o.A,{sx:{height:B},children:(0,D.jsx)(A.ED,(0,i.A)({data:J,keys:["Active","Paid","Overdue"],indexBy:"month",colors:e=>{let{id:t}=e;return F[t]},ariaLabel:"Loan Status Count Over Time Stacked Bar Chart"},z("stackedBar",v,!1,r,F,null)))}):(0,D.jsx)(K,{height:B,message:"No historical loan status data available."})]})})]}),(0,D.jsxs)(u.A,{open:R,onClose:H,maxWidth:"lg",fullWidth:!0,TransitionComponent:O,sx:{"& .MuiDialog-paper":{height:"90vh",maxHeight:"90vh",display:"flex",flexDirection:"column",p:v?1:3}},children:[(0,D.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1,pr:0},children:[(0,D.jsx)(l.A,{variant:"h5",sx:{fontWeight:600},children:null===T||void 0===T?void 0:T.title}),(0,D.jsx)(d.A,{"aria-label":"close",onClick:H,children:(0,D.jsx)(b.A,{})})]}),(0,D.jsxs)(f.A,{sx:{flexGrow:1,p:0},children:[T&&"line"===T.type&&V&&(0,D.jsx)(o.A,{sx:{height:"100%"},children:(0,D.jsx)(j.bt,(0,i.A)({data:T.data,ariaLabel:"Monthly Disbursements and Collections Line Chart"},z("line",v,!0,r,null,N)))}),T&&"pie"===T.type&&Z.length>0&&Z.some(e=>e.value>0)&&(0,D.jsx)(o.A,{sx:{height:"100%"},children:(0,D.jsx)(y.fO,(0,i.A)({data:T.data,colors:e=>{let{id:t}=e;return F[t]},ariaLabel:"Loan Status Distribution Pie Chart"},z("pie",v,!0,r,null,null)))}),T&&"bar"===T.type&&q.length>0&&q.some(e=>e.count>0)&&(0,D.jsx)(o.A,{sx:{height:"100%"},children:(0,D.jsx)(A.ED,(0,i.A)({data:T.data,keys:T.keys,indexBy:T.indexBy,ariaLabel:"Loan Amount Distribution Bar Chart"},z("bar",v,!0,r,null,N)))}),T&&"stackedBar"===T.type&&J.length>0&&J.some(e=>e.Active>0||e.Paid>0||e.Overdue>0)&&(0,D.jsx)(o.A,{sx:{height:"100%"},children:(0,D.jsx)(A.ED,(0,i.A)({data:T.data,keys:T.keys,indexBy:T.indexBy,colors:e=>{let{id:t}=e;return F[t]},ariaLabel:"Loan Status Count Over Time Stacked Bar Chart"},z("stackedBar",v,!0,r,F,null)))})]})]})]})}}}]);
//# sourceMappingURL=808.ad74101b.chunk.js.map